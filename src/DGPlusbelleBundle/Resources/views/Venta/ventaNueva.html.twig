{% extends 'DGPlusbelleBundle:Layout:layouterp.html.twig' %}

{% block css %}
    {{parent()}}
    <link rel="stylesheet" href="{{ asset('Resources/dropzone/dropzone.css') }}">
    <link rel="stylesheet" href="{{ asset('Resources/alertifyjs/css/alertify.css') }}">
    <link rel="stylesheet" href="{{ asset('Resources/swal/sweetalert2.min.css') }}">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.1.0/material.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.11/css/dataTables.material.min.css">
    <link rel="stylesheet" href="{{ asset('Resources/alertifyjs/css/alertify.css') }}">
    <style>
        .placas>div:last-child {
            position:absolute;
        }
        .addItem{
            position: absolute;
            height: 50px;
            float: right;
            margin-bottom: 50px;
            padding-bottom: 100px;
            top: -65px;
            left: -2px;
        }
        
            .addItem div {
                position: absolute;
            }
        
        #dgplusbellebundle_consulta_horaInicio_hourSelectBoxItContainer, #dgplusbellebundle_consulta_horaInicio_minuteSelectBoxItContainer{
            width:75px;
        }
        
        #listadoa>div>div>div>div>label{
            display: none;
        }
        
        textarea{
            resize: none;
        }
        
        #info_paciente tr td{
            border: 1px solid black;
        }
        .tab-pane{
            background-color:#FFF;
        }
    </style>
    
{% endblock %}

{% block descripcion %}
    <div class="col-md-12" style="margin-bottom: 20px;">
        <p class="robo" style="font-weight: 300; margin-bottom: 0px; font-size: 27px;">Nueva venta de paquete/tratamiento</p>
    </div>
    <div class="col-md-4" style="margin-bottom: 20px;">
        <label class="robo" style="font-weight: 300; font-size: 16px; height: 25px;">Busqueda del paciente</label>
        <select id="busqueda-paciente" name="busquedaPaciente" class="form-control input-sm " data-rule-required="true" style=" width: 100%;">
            <option value="0" disabled selected>Seleccione un paciente ...</option>
        </select> 
    </div>
{% endblock %}

{% block contenido -%}
    <!-- ============================================
    MAIN CONTENT SECTION
    =============================================== -->
    
    <div class="content">
        <div class="content-body">
            <div class="panel" data-fill-color="true">
                <div class="content-hero content-hero-lg" style="margin-bottom: 30px; border-bottom: 1px #CCC solid; min-height:50px; display:none;" id="info-Paciente" >
                    <div class="content-hero-bar">
                        <div class="row">
                            <div class="col-md-12" >
                                <hr>
                            </div>
                            <div class="col-md-12" >
                                <div class="col-md-8">
                                    <h4 class="robo media-heading text-light" id="nombrePaciente"></h4>
                                    <p class="mb-4x text-light">
                                        <span class="mr-1x" id="expediente">
                                            <i class="fa fa-clipboard"></i> 
                                        </span>
                                        <span class="mr-1x" id="telefono">
                                            <i class="fa fa-phone"></i>
                                        </span>
                                        <span class="mr-1x" id="edad">
                                            <i class="fa fa-birthday-cake"></i>                                            
                                        </span>
                                        <span class="mr-1x" id="direccion">
                                            <i class="fa fa-map-marker fa-fw"></i>
                                        </span>
                                    </p>
                                </div>
                                <div class="col-md-4 robo" ></div>
                                </div>
                            </div><!-- /.media-body -->
                        </div><!-- /.cols -->
                    </div><!-- /.row -->
                </div><!-- /.content-hero-bar -->
                <div class="row" style="display:none;"></div>
                
                <div id="acciones-venta"    >
                    {# Aquí se colocan los nombres de cada sección (tabs) #}    
                    <ul class="nav nav-tabs" style="margin-top: 30px;">
                        <li><a data-toggle="tab" href="#datos-generales">Datos generales</a></li>
                        <li class="active"><a data-toggle="tab" href="#registros-venta">Registro de venta</a></li>
                        <li><a data-toggle="tab" href="#seguimiento-venta" style="display:none;" id="tabs-seguimiento">Registro y seguimiento de sesiones</a></li>
                        <li><a data-toggle="tab" href="#abonos-devoluciones" style="display:none;" id="tabs-abdev">Abonos</a></li>
                        <li><a data-toggle="tab" href="#imagenes" style="display:none;" id="tabs-imagenes">Imagenes</a></li>
                    </ul>

                    {# Aquí se encuentran las secciones de las tabs #}    
                    <div class="tab-content">
                        {# Sección en donde se registra la información general del paciente a quien se le va a efectuar la venta #}
                        <div id="datos-generales" class="tab-pane fade" style="margin-top: 20px;">
                            <form id="formulario-datos-gnales" method="POST" enctype="multipart/form-data">
                                <div class="row" style="margin-top: 30px;">
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa el nombre del paciente a quien se le hará la venta #}    
                                        <div id="nombrePaciente-venta">
                                            <label>Nombres</label>
                                            <input type="text" name="dgplusbellebundle_venta[nombres]" id="dgplusbellebundle_venta_nombres" class="form-control" style="width: 100%" {#value="{{ paciente.persona.nombres}}"#}>      
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa los apellidos del paciente a quien se le hará la venta #}    
                                        <div id="apellidosPaciente-venta">
                                            <label>Apellidos</label>
                                            <input type="text" name="dgplusbellebundle_venta[apellidos]" id="dgplusbellebundle_venta_apellidos" class="form-control" style="width: 100%" {#value="{{ paciente.persona.apellidos}}"#}>     
                                        </div>
                                    </div> 
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa el telefono 1 del paciente a quien se le hará la venta #}    
                                        <div id="telefono1Paciente-venta">
                                            <label>Telefono 1</label>
                                            <input type="text" name="dgplusbellebundle_venta[telefono1]" id="dgplusbellebundle_venta_telefono1" class="form-control" style="width: 100%" {#value="{{ paciente.persona.telefono}}"#}>     
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa el telefono 1 del paciente a quien se le hará la venta #}    
                                        <div id="telefono2Paciente-venta">
                                            <label>Telefono 2</label>
                                            <input type="text" name="dgplusbellebundle_venta[telefono2]" id="dgplusbellebundle_venta_telefono2" class="form-control" style="width: 100%" {#value="{{ paciente.persona.telefono2}}"#}>     
                                        </div>
                                    </div>    
                                </div>    
                                <div class="row" style="margin-top:30px;">
                                    <div class="col-md-3" >
                                        {# Area en donde se ingresa la dirección de la persona #}    
                                        <div id="direccionPaciente-venta">
                                            <label>Direccion</label>
                                            <input type="text" name="dgplusbellebundle_venta[direccion]" id="dgplusbellebundle_venta_direccion" class="form-control" style="width: 100%" {#value="{{ paciente.persona.direccion }}"#}>      
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa correo electrónico del paciente a quien se le hará la venta #}    
                                        <div id="correoPaciente-venta">
                                            <label>Correo electronico</label>
                                            <input type="text" name="dgplusbellebundle_venta[correo]" id="dgplusbellebundle_venta_correo" class="form-control" style="width: 100%" {#value="{{ paciente.persona.email}}"#}>     
                                        </div>
                                    </div> 
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa DUI del paciente a quien se le hará la venta #}    
                                        <div id="DUIPaciente-venta">
                                            <label>DUI</label>
                                            <input type="text" name="dgplusbellebundle_venta[dui]" id="dgplusbellebundle_venta_dui" class="form-control" style="width: 100%" {#value="{{ paciente.dui}}"#}>     
                                        </div>
                                    </div> 
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa estado civil del paciente a quien se le hará la venta #}    
                                        <div id="EcivilPaciente-venta">
                                            <label>Estado civil</label>
                                            <select id="dgplusbellebundle_venta_ecivil" name="dgplusbellebundle_venta[ecivil]" class="form-control venta-ecivil" style="width: 100%">
                                                <option value="" disabled style="display:none;" >Seleccione un estado civil ...</option>
                                                <option value="Soltero/a">Soltero/a</option>
                                                <option value="Casado/a">Casado/a</option>
                                                <option value="Divorciado/a">Divorciado/a</option>
                                                <option value="Acompañado/a">Acompañado/a</option>
                                                <option value="Viudo/a">Viudo/a</option>
                                            </select>
                                        </div>
                                    </div>    
                                </div>
                                <div class="row" style="margin-top: 30px;">  
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa estado civil del paciente a quien se le hará la venta #}    
                                        <div id="sexoPaciente-venta">
                                            <label>Sexo </label>
                                            <select id="dgplusbellebundle_venta_sexo" name="dgplusbellebundle_venta[sexo]" class="form-control venta-sexo" style="width: 100%">
                                                <option value="" disabled style="display:none;" >Seleccione sexo ...</option>
                                                <option value="M">Masculino</option>
                                                <option value="F">Femenino</option>
                                            </select>
                                        </div>
                                    </div> 
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa la ocupacion del paciente a quien se le hará la venta #}    
                                        <div id="ocupacionPaciente-venta">
                                            <label>Ocupación</label>
                                            <input type="text" name="dgplusbellebundle_venta[ocupacion]" id="dgplusbellebundle_venta_ocupacion" class="form-control" style="width: 100%" {#value="{{ paciente.ocupacion}}"#}>     
                                        </div>
                                    </div> 
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa la ocupacion del paciente a quien se le hará la venta #}    
                                        <div id="lugarTrabajoPaciente-venta">
                                            <label>Lugar de trabajo</label>
                                            <input type="text" name="dgplusbellebundle_venta[lugar]" id="dgplusbellebundle_venta_lugar" class="form-control" style="width: 100%" {#value="{{ paciente.lugarTrabajo}}"#}>     
                                        </div>
                                    </div> 
                                    <div class="col-md-3">
                                        {# Area en donde se selecciona la fecha de naciemto del paciente a quien se le hará la venta #}    
                                        <div id="fechaNacimiemtoPaciente-venta">
                                            <label>Fecha de Nacimiento</label>
                                            <input type="text" name="dgplusbellebundle_venta[fechaNacimiemto]" id="dgplusbellebundle_venta_fechaNacimiemto" class="form-control calZebra" style="width: 100%" {#value="{{ paciente.fechaNacimiento|date('d-m-Y') }}"#}>      
                                        </div>
                                    </div>    
                                </div> 
                                <div class="row" style="margin-top: 30px;">
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa el nombre de la persona a quien llamar en caso de emergencia #}    
                                        <div id="referidoporPaciente-venta">
                                            <label>Referido por</label>
                                            <input type="text" name="dgplusbellebundle_venta[referidopor]" id="dgplusbellebundle_venta_referidopor" class="form-control" style="width: 100%" {#value="{{ paciente.referidoPor }}"#}>      
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        {# Area en donde se ingresa el nombre de la persona a quien llamar en caso de emergencia #}    
                                        <div id="nombreEmergenciaPaciente-venta">
                                            <label>En caso de emergencia llamar a</label>
                                            <input type="text" name="dgplusbellebundle_venta[nombreEmergencia]" id="dgplusbellebundle_venta_nombreEmergencia" class="form-control" style="width: 100%" {#value="{{ paciente.personaEmergencia }}"#}>      
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        {# Area en donde se ingresa el telefono de la persona a quien llamar en caso de emergencia #}    
                                        <div id="telefonoEmergenciaPaciente-venta">
                                            <label>Al telefono</label>
                                            <input type="text" name="dgplusbellebundle_venta[telefonoEmergencia]" id="dgplusbellebundle_venta_telefonoEmergencia" class="form-control" style="width: 100%" {#value="{{ paciente.telefonoEmergencia }}"#}>     
                                        </div>
                                    </div>
                                </div>     
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 text-center" style="margin-top: 30px; margin-bottom: 10px;" id="registrar-datos-gnales">
                                        <hr>
                                        <input type="submit" value="Registrar informacion del paciente" style="margin-bottom: 10px; color: #FFF;" class="btn btn-xs btn-primary" id="editar-paciente"/>
                                    </div>    
                                </div>         
                            </form>
                            <div class="row" style="margin-top: 50px;"></div>            
                        </div>

                        {# Sección en donde se registran ventas de paqutes/tratamientos #}                
                        <div id="registros-venta" class="tab-pane fade in active" style="margin-top: 20px;">
                            <form id="formulario-venta" method="POST" enctype="multipart/form-data">
                                <div class="row" style="margin-top: 30px;">
                                    {# Selección de qué tipo de venta se va a realizar #}    
                                    <div class="col-md-2">
                                        <label class="pull-right">Tipo de venta:</label>      
                                    </div>
                                    <div class="col-md-2">
                                        <div id="label-tipo-venta">
                                            <p>
                                                <input type = "radio" name = "tipo-venta" id = "tipo-venta-paquete" value = "1" />
                                                <label for = "tipo-venta-paquete">Paquete</label>
                                            </p>
                                            <p>
                                                <input type = "radio" name = "tipo-venta" id = "tipo-venta-tratamiento" value = "0" />
                                                <label for = "tipo-venta-tratamiento">Tratamiento</label>
                                            </p> 
                                        </div>
                                    </div>

                                    {# Area en donde se selecciona un paquete o tratamiento dependiendo el tipo de venta seleccionado#}    
                                    <div class="col-md-3 col-md-offset-1">
                                        <div id="venta-paquete" style="display:none;">
                                            <label>Paquete</label>
                                            <select id="dgplusbellebundle_venta_paquete" name="dgplusbellebundle_venta[paquete]" class="venta-paquete" style="width: 100%">
                                                <option value="" disabled selected>Seleccione un paquete...</option>

                                                {% for vpaquete in ventaPaquetes %}
                                                    <option value="{{vpaquete.id}}"> {{vpaquete.nombre}}</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                        <div id="venta-tratamiento" style="display:none;">
                                            <label>Tratamiento</label>
                                            <select id="dgplusbellebundle_venta_tratamiento" name="dgplusbellebundle_venta[tratamiento]" class="venta_tratamiento" style="width: 100%">
                                                <option value="" disabled selected>Seleccione un tratamiento...</option>

                                                {% for vtratamiento in ventaTratamientos %}
                                                    <option value="{{vtratamiento.id}}"> {{vtratamiento.nombre}}</option>
                                                {% endfor %}
                                            </select>    
                                        </div>    
                                    </div>
                                </div>   
                                <div class="row" style="margin-top: 35px;">
                                    <div class="col-md-4" >
                                        {# Area en donde se selecciona la sucursal en donde se realiza la venta #}    
                                        <div id="sucursal-venta" style="display:none;">
                                            <label>Sucursal</label>
                                            <select id="dgplusbellebundle_venta_sucursal" name="dgplusbellebundle_venta[sucursal]" class="venta-sucursal" style="width: 100%">
                                                <option value="" disabled selected>Seleccione una sucursal ...</option>

                                                {% for sucursal in sucursales %}
                                                    <option value="{{sucursal.id}}"> {{sucursal.nombre}}</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        {# Area en donde se selecciona  el empleado que ha realizado la venta #}  
                                        <div id="empleados-venta" style="display:none;">
                                            <label>Vendido por</label>
                                            <select id="dgplusbellebundle_venta_empleado" name="dgplusbellebundle_venta[empleado]" class="venta-empleado" style="width: 100%">
                                                <option value="" disabled selected>Seleccione un empleado ...</option>

                                                {% for empleado in empleadosVenta %}
                                                    <option value="{{empleado.id}}"> {{empleado.persona}}</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                    </div>        
                                    <div class="col-md-4">
                                        {# Area en donde se ingresa  el número de sesiones de un tratamiento en el caso 
                                           de haber seleccionado el tipo de venta tratamiento                           #}  
                                        <div id="sesiones-tratamiento" style="display:none;">
                                            <label># de sesiones</label>
                                            <input type="text" name="dgplusbellebundle_venta[num_sesiones]" id="dgplusbellebundle_venta_sesiones" class="form-control" style="width: 100%">   
                                        </div>
                                    </div>        
                                </div>     
                                <div class="row" style="margin-top: 35px;">
                                    <div class="col-md-4">
                                        {# Area en donde se ingresa  el cossto($) del paquete o tratamiento que se ha vendido #}
                                        <div id="costo-venta" style="display:none;">
                                            <label>Costo ($)</label>
                                            <input type="text" name="dgplusbellebundle_venta[costo]" id="dgplusbellebundle_venta_costo" class="form-control" style="width: 100%">     
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        {# Area en donde se seleciona  el descuento que se le va a aplicar a la venta en el caso de ser necesario #} 
                                        <div id="descuento-venta" style="display:none;">
                                            <label>Descuento</label>
                                            <select id="dgplusbellebundle_venta_descuento" name="dgplusbellebundle_venta[descuento]" class="venta-descuento" style="width: 100%">
                                                <option value="" selected>Seleccione un tipo de descuento ...</option>

                                                {% for descuento in descuentos %}
                                                    <option value="{{descuento.id}}"> {{descuento.nombre}} - {{descuento.porcentaje}}%</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                    </div>        
                                    <div class="col-md-4">
                                        <div id="cuotas-venta" style="display:none;">
                                            <label>Cuotas</label>
                                            <input type="text" name="dgplusbellebundle_venta[cuotas]" id="dgplusbellebundle_venta_cuotas" class="form-control" style="width: 100%">   
                                        </div>
                                    </div>        
                                </div>
                                <div class="row">
                                    <div id="vventa-observaciones" class="col-md-7 col-sm-7" style="margin-top: 30px; margin-bottom: 10px; display:none;">
                                        <div id="venta-observaciones-label">
                                            <label>Observaciones</label>
                                        </div> 
                                        <div class="clearfix"></div>
                                        <div id="observaciones">
                                            <textarea rows="4" cols="100" name="dgplusbellebundle_abono[observaciones]" id="dgplusbellebundle_venta_observaciones" class="form-control"></textarea> 
                                        </div>     
                                    </div>    
                                </div>             
                                <div class="row" style="margin-top: 50px;">
                                    <hr id="hr-tratamientos-paquete" class="hide">
                                    <div class="col-md-6 col-md-offset-2">
                                        <div id="tratamientos-paquete" style="display:none;"></div>
                                    </div>    
                                </div>            
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 text-center" style="margin-top: 30px; margin-bottom: 10px; display:none;" id="registrar-venta">
                                        <hr>
                                        <input type="submit" value="Registrar venta" style="margin-bottom: 10px; color: #FFF;" class="btn btn-xs btn-primary" id="registro-venta"/>
                                    </div>  

                                    <div class="col-md-12 col-sm-12 text-center" style="margin-top: 30px; margin-bottom: 10px; display:none;" id="modificar-venta">
                                        <hr>
                                        <input type="submit" value="Editar venta" style="margin-bottom: 10px; color: #FFF;" class="btn btn-xs btn-primary" id="edit-venta"/>
                                    </div>
                                </div> 
                            </form>                
                            <div class="row" style="margin-top: 50px;"></div>
                        </div>

                        {# Sección en donde se registran las sesiones de un tratamiento #}
                        <div id="registro-sesiones" class="tab-pane fade" style="margin-top: 20px;">
                            <form id="formulario-sesiones-tratamiento" method="POST" enctype="multipart/form-data">
                                <div class="row" style="margin-top: 35px;" style="display:none;">
                                    <div class="col-md-3"  style="margin-left: 30px;">
                                        {# Area en donde se selecciona la sucursal en donde se realiza la venta #}    
                                        <div id="sucursal-sesion">
                                            <label>Sucursal</label>
                                            <select id="dgplusbellebundle_sesioness_sucursal" name="dgplusbellebundle_venta_sesiones[sucursal]" class="sesion-sucursal" style="width: 100%">
                                                <option value="" disabled selected>Seleccione una sucursal ...</option>

                                                {% for sucursal in sucursales %}
                                                    <option value="{{sucursal.id}}"> {{sucursal.nombre}}</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        {# Area en donde se selecciona  el empleado que ha realizado la venta #}  
                                        <div id="empleado-sesion">
                                            <label>Empleado</label>
                                            <select id="dgplusbellebundle_sesioness_empleado" name="dgplusbellebundle_venta_sesiones[empleado]" class="sesion-empleado" style="width: 100%">
                                                <option value="" disabled selected>Seleccione un empleado ...</option>

                                                {% for empleado in empleadosVenta %}
                                                    <option value="{{empleado.id}}"> {{empleado.persona}}</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                    </div> 
                                    <div class="col-md-3" style="display:none;" id="seguimiento-sesioness-tratamiento">
                                        <div id="sesiones-tratamiento">
                                            <label>Tratamiento</label>
                                            <select id="dgplusbellebundle_sesioness_tratamiento" name="dgplusbellebundle_venta_sesiones[tratamiento]" class="sesion_tratamiento" style="width: 100%">
                                                <option value="" disabled selected>Seleccione un tratamiento...</option>
                                            </select>    
                                        </div>    
                                    </div>        
                                </div>
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 text-center" style="margin-top: 30px; margin-bottom: 10px;" id="registrar-sesiones-tratamiento">
                                        <hr>
                                        <input type="submit" value="Registrar sesión de tratamiento" style="margin-bottom: 10px; background-color: #39a58a; color: #FFF;" class="btn" id="registro-sesioness-tratamiento"/>
                                    </div>    
                                </div>             
                            </form>
                            <div class="row" style="margin-top: 50px;"></div>                
                        </div>

                        {# Sección en donde se encuentran las imagenes de un determinado tratamiento #}
                        <div id="imagenes" class="tab-pane fade" style="margin-top: 20px;">
                            <div class="row" style="margin-top: 35px; padding: 30px;" style="display:none;">
                                <form id="formImagen" role="form" enctype="multipart/form-data" method="post">
                                <div class="col-md-3 pull-center" id="imagenes-sesiones-tratamiento">
                                    <div id="sesiones-tratamiento">
                                        <label>Tratamiento</label>
                                        <select id="dgplusbellebundle_imagenes_tratamiento" name="venta_imagenes_tratamiento" class="sesion_tratamiento" style="width: 100%">
                                            <option value="" disabled selected>Seleccione un tratamiento...</option>
                                        </select>    
                                    </div>    
                                </div>
                                <div class="col-md-3 col-md-offset-1 pull-center" id="imagenes-sesiones-sesiones">
                                    <div class="row">        
                                        <strong>Subir imagen</strong>
                                        <div class="row" style="margin-top:20px;">
                                            <div class="col-md-12">

                                                    <input id="file-input" required type="file" name="file[]" multiple>
                                                    <input type="hidden" id="idSesion" name="idSesion" class="form-control input-sm"/>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </form>        
                            </div>
                            <div class="row" style="margin-top:20px; padding: 30px;">
                                <div class="col-md-12">
                                    <strong style="margin-top:80px;">Archivos adjuntos</strong>
                                </div>    
                                <div class="col-md-12">
                                    <div id="listadoImagenes"></div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-sm-12 text-center" style="margin-top: 30px; margin-bottom: 10px;" id="registrar-sesiones-imagenes">
                                    <hr>
                                    <input type="submit" value="Guardar imagenes" style="margin-bottom: 10px; background-color: #39a58a; color: #FFF;" class="btn" id="registro-sesiones-imagenes"/>
                                </div>    
                            </div>                
                        </div>

                        {# Sección en donde se muestra el seguimiento de la venta #}
                        <div id="seguimiento-venta" class="tab-pane fade" style="margin-top: 20px;">
                            <div class="row" style="margin-top: 0px;">
                                <div class="col-md-12" style="margin-bottom: 25px;">
                                   <form id="formulario-sesiones-tratamiento" method="POST" enctype="multipart/form-data">
                                        <div class="row" style="margin-top: 0px;" style="display:none;">
                                            <div class="col-md-4" >
                                                {# Area en donde se selecciona la sucursal en donde se realiza la venta #}    
                                                <div id="sucursal-sesion">
                                                    <label>Sucursal</label>
                                                    <select id="dgplusbellebundle_sesiones_sucursal" name="dgplusbellebundle_venta_sesiones[sucursal]" class="sesion-sucursal" style="width: 100%">
                                                        <option value="" disabled selected>Seleccione una sucursal ...</option>

                                                        {% for sucursal in sucursales %}
                                                            <option value="{{sucursal.id}}"> {{sucursal.nombre}}</option>
                                                        {% endfor %}
                                                    </select>   
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                {# Area en donde se selecciona  el empleado que ha realizado la venta #}  
                                                <div id="empleado-sesion">
                                                    <label>Empleado</label>
                                                    <select id="dgplusbellebundle_sesiones_empleado" name="dgplusbellebundle_venta_sesiones[empleado]" class="sesion-empleado" style="width: 100%">
                                                        <option value="" disabled selected>Seleccione un empleado ...</option>

                                                        {% for empleado in empleadosVenta %}
                                                            <option value="{{empleado.id}}"> {{empleado.persona}}</option>
                                                        {% endfor %}
                                                    </select>   
                                                </div>
                                            </div> 
                                            <div class="col-md-4" style="display:none;" id="seguimiento-sesiones-tratamiento">
                                                <div id="sesiones-tratamiento">
                                                    <label>Tratamiento</label>
                                                    <select id="dgplusbellebundle_sesiones_tratamiento" name="dgplusbellebundle_venta_sesiones[tratamiento]" class="sesion_tratamiento" style="width: 100%">
                                                        <option value="" disabled selected>Seleccione un tratamiento...</option>
                                                    </select>    
                                                </div>    
                                            </div>        
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 col-sm-12 text-center" style="margin-top: 30px; margin-bottom: 10px;" id="registrar-sesiones-tratamiento">
                                                <input type="submit" value="Registrar sesión de tratamiento" style="margin-bottom: 10px; color: #FFF;" class="btn btn-primary btn-xs" id="registro-sesiones-tratamiento"/>
                                            </div>    
                                        </div>             
                                    </form> 
                                </div>
                            </div>
                            <div class="row" id="detalle-venta-info">
                                 <div class="col-md-12" style="margin-bottom: 25px;">
                                    <hr>
                                </div>
                                <div class="col-md-8" style="margin-left: 30px;">
                                    <div class="row">
                                        <div class="col-md-2" style="margin-bottom: 10px;">
                                            <strong>Costo:</strong>
                                        </div>
                                        <div class="col-md-2" style="margin-bottom: 10px;">
                                            <span id="detalle-venta-costo"></span>
                                        </div>
                                        <div class="col-md-2" style="margin-bottom: 10px;">
                                            <strong>Cuotas:</strong>
                                        </div>
                                        <div class="col-md-2" style="margin-bottom: 10px;">
                                            <span id="detalle-venta-cuotas"></span>
                                        </div>
                                        <div class="col-md-2" style="margin-bottom: 10px;">
                                            <strong>Deuda:</strong><span></span>
                                        </div>
                                        <div class="col-md-2" style="margin-bottom: 10px;">
                                            <span id="detalle-venta-deuda">
                                            </span>
                                        </div>
                                    </div>  
                                </div>
                                <div class="clearfix"></div>
                                <div class="col-md-12" style="margin-bottom: 25px;">
                                    <hr>
                                </div>
                                <div class="col-md-6" style=" margin-top: 10px;">
                                    <div class="row">
                                        <div class="col-md-6" style="margin-bottom: 20px;">
                                            <div class="row">
                                                <div class="col-md-4" style="margin-bottom: 20px;">
                                                    <strong>Paquete: </strong>
                                                </div>
                                                <div class="col-md-8" style="margin-bottom: 20px;">
                                                    <span></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-1" style="margin-bottom: 20px;">
                                            <img class='' style='height: 25px;'  src='{{ asset('Photos/Estados/sesion_realizada.png')}}' title='Sesion pendiente'>
                                        </div>
                                        <div class="col-md-2" style="margin-bottom: 20px;">
                                            <span>Sesion realizada</span>
                                        </div>
                                        <div class="col-md-1" style="margin-bottom: 20px;">
                                            <img class='' style='height: 25px;'  src='{{ asset('Photos/Estados/sesion_pendiente.png')}}' title='Sesion pendiente'>
                                        </div>
                                        <div class="col-md-2" style="margin-bottom: 20px;">
                                            <span>Sesion pendiente</span>
                                        </div>
                                    </div> 
                                    <div class="row">
                                        <div class="col-md-12" style="margin-bottom: 10px;">
                                            <hr>
                                            <p class="text-center"><strong>Sesiones</strong></p>
                                            <hr>
                                        </div>
                                    </div> 
                                    <div id="detalle-venta-tratamientos">

                                    </div>    
                                    <div class="row">
                                        <div class="col-md-12" style="margin-bottom: 10px;">
                                            <hr>
                                        </div>
                                    </div>             
                                </div>
                                <div class="col-md-6 col-sm-5" >
                                    <div class="row">
                                        <div class="col-md-12 col-sm-12">
                                            <div id="listadoPaquete" style="display: none;">
                                                <table id="listadoSesiones1" class="robo listados table table-bordered table-hover" style="width:100%;">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">Fecha de sesión</th>
                                                            <th class="text-center">Tratamiento</th>
                                                            <th class="text-center">Empleado</th>
                                                            <th class="text-center">Sucursal</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                            <div id="listadoTratamiento" style="display: none;">
                                                <table id="listadoSesiones2" class="robo listados table table-bordered table-hover" style="width:100%;">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">Fecha de sesión</th>
                                                            <th class="text-center">Empleado</th>
                                                            <th class="text-center">Sucursal</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>                            
                        </div>                

                        {# Sección en donde se registran los abonos y devoluciones de un paquete o tratamiento #}
                        <div id="abonos-devoluciones" class="tab-pane fade" style="margin-top: 20px;">
                            <form id="formulario-sesiones-tratamiento" method="POST" enctype="multipart/form-data">
                                <div class="row">
                                    <div class="col-md-4" >
                                        {# Area en donde se selecciona la sucursal en donde se realiza la venta #}    
                                        <div id="sucursal-sesion">
                                            <label>Sucursal</label>
                                            <select id="dgplusbellebundle_abono_sucursal" name="dgplusbellebundle_abono[sucursal]" class="sesion-sucursal" style="width: 100%">
                                                <option value="" disabled selected>Seleccione una sucursal ...</option>

                                                {% for sucursal in sucursales %}
                                                    <option value="{{sucursal.id}}"> {{sucursal.nombre}}</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        {# Area en donde se selecciona  el empleado que ha realizado la venta #}  
                                        <div id="empleado-sesion">
                                            <label>Empleado</label>
                                            <select id="dgplusbellebundle_abono_empleado" name="dgplusbellebundle_abono[empleado]" class="sesion-empleado" style="width: 100%">
                                                <option value="" disabled selected>Seleccione un empleado ...</option>

                                                {% for empleado in empleadosVenta %}
                                                    <option value="{{empleado.id}}"> {{empleado.persona}}</option>
                                                {% endfor %}
                                            </select>   
                                        </div>
                                    </div> 
                                    <div class="col-md-4">
                                        <div id="abono-monto">
                                            <label>Monto ($)</label>
                                            <input type="text" name="dgplusbellebundle_abono[monto]" id="dgplusbellebundle_abono_monto" class="form-control" style="width: 100%">        
                                        </div>    
                                    </div>        
                                </div>
                                <div class="row">
                                    <div class="col-md-7 col-sm-7" style="margin-top: 30px; margin-bottom: 10px;" id="abono">
                                        <div id="abono-descripcion-label">
                                            <label>Descripcion</label>
                                        </div> 
                                        <div class="clearfix"></div>
                                        <div id="abono-descripcion">
                                            <textarea rows="4" cols="100" name="dgplusbellebundle_abono[descripcion]" id="dgplusbellebundle_abono_descripcion" class="form-control"></textarea> 
                                        </div>     
                                    </div>    
                                </div>               
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 text-center" style="margin-top: 30px; margin-bottom: 10px;" id="registrar-abonos-sesiones">
                                        <hr>
                                        <input type="submit" value="Registrar abono" style="margin-bottom: 10px; color: #FFF;" class="btn btn-xs btn-primary" id="registro-abono"/>
                                    </div>    
                                </div>              
                            </form>
                            <div class="row" style="margin-top: 50px;"></div>          
                        </div>
                    </div> 
                </div>
            </div><!-- /.panel -->
        </div>
    </div>
    {% endblock %}
    
    {% block javascripts_step %}
        <script src="{{ asset('Resources/alertifyjs/alertify.js') }}"></script>
        <script src="{{ asset('Resources/js/ConsultaPaciente.js') }}"></script>
        <script src="{{ asset('Resources/js/ConsultaEstetica.js') }}"></script>

        <script src="{{ asset('Resources/dropzone/dropzone.js') }}"></script>

        <script src="{{ asset('Resources/swal/sweetalert2.min.js') }}"></script>

        <script src="{{ asset('Resources/wrapkit/scripts/jquery.mask.js') }}"></script>
        <script src="{{ asset('Resources/Zebra/js/zebra_datepicker.js') }}"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.min.js"></script>
        <script src="{{ asset('Resources/wrapkit/scripts/bootbox.js') }}"></script>
        <script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.11/js/dataTables.material.min.js "></script>
        <script src="{{ asset('Resources/src/js/bootstrap.js')}}"></script>
        
        <script>
            var id_ventapaquete = 0;
            var id_ventatratamiento = 0;
            var pendientes = 0;
            var deuda_total = 0;
            var idPac = 0;
            var url = "{{path('admin_sesiones_paciente_data_paquete')}}"+'?id='+id_ventapaquete;

            var table1 = $('#listadoSesiones1').DataTable({
                dom:'tp',
                "processing": false,
                "serverSide": true,
                "pageLength": 3,
                "ajax": {
                    "url": url,
                    "type": 'GET'
                },
                "columns": [
                    { "data": "fechaSesion" },
                    { "data": "tratamiento" },
                    { "data": "empleado" },
                    { "data": "sucursal" }
                ],
                    "columnDefs": [
                           {"width":10, "orderable": false, "targets": 0 },
                           {"width":45, "orderable": false, "targets": 1 },
                           {"width":30, "orderable": false, "targets": 2 },
                           {"width":15, "orderable": false, "targets": 3 }
                    ],
                    "language": {
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "",
                    "infoFiltered": "filtrando de _MAX_ registros",
                    "emptyTable": "No se encontraron registros",
                    "paginate": { 
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "processing": "Procesando petición...",
                    "search": "Buscar registros:",
                    "lengthMenu": "Mostrar _MENU_ registros"
                }, 

            });
            
            var url2 = "{{path('admin_sesiones_paciente_data_tratamiento')}}"+'?id='+id_ventatratamiento;

            var table2 = $('#listadoSesiones2').DataTable({
                dom:'tp',
                "processing": false,
                "serverSide": true,
                "pageLength": 3,
                "ajax": {
                    "url": url2,
                    "type": 'GET'
                },
                "columns": [
                    { "data": "fechaSesion" },
                    { "data": "empleado" },
                    { "data": "sucursal" }
                ],
                    "columnDefs": [
                           {"width":10, "orderable": false, "targets": 0 },
                           {"width":45, "orderable": false, "targets": 1 },
                           {"width":30, "orderable": false, "targets": 2 }
                    ],
                    "language": {
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "",
                    "infoFiltered": "filtrando de _MAX_ registros",
                    "emptyTable": "No se encontraron registros",
                    "paginate": { 
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "processing": "Procesando petición...",
                    "search": "Buscar registros:",
                    "lengthMenu": "Mostrar _MENU_ registros"
                }, 

            });
            
            function formatRepo (data) {
                if(data.nombres){
                    var markup = "<div class='select2-result-repository clearfix'>" +
                                 "<div class='select2-result-repository__meta'>" +
                                 "<div class='select2-result-repository__title'>" + data.numero + " - " + data.nombres + " " + data.apellidos + "</div>" +
                                 "</div></div>";
                } else {
                    var markup = "Seleccione un paciente";
                }

                return markup;
            }

            function formatRepoSelection (data) {
                if(data.nombres){
                    return data.numero + " - " + data.nombres + " " + data.apellidos;
                } else {
                    return "Seleccione un paciente";
                }   
            }
            
            $(document).ready(function(){
                $("#busqueda-paciente").select2({
                    ajax: {
                        url: "{{path('busqueda_paciente_form')}}",
                        dataType: 'json',
                        delay: 250,
                        data: function (params) {
                          return {
                            q: params.term, 
                            page: params.page
                          };
                        },
                        processResults: function (data, params) {
                            var select2Data = $.map(data.data, function (obj) {
                                obj.id = obj.pacienteid;
                                obj.text = obj.numero + ' - ' + obj.nombres + ' ' + obj.apellidos;

                                return obj;
                            });

                            return {
                                results: select2Data};
                        },
                        cache: true
                    },
                    escapeMarkup: function (markup) { return markup; }, 
                    minimumInputLength: 1,
                    templateResult: formatRepo, 
                    templateSelection: formatRepoSelection 
                });
                
                $("#dgplusbellebundle_venta_sexo").select2();
                $("#dgplusbellebundle_venta_ecivil").select2();
                
                $("#dgplusbellebundle_venta_paquete").select2();
                $("#dgplusbellebundle_venta_tratamiento").select2();
                $("#dgplusbellebundle_venta_sucursal").select2();
                $("#dgplusbellebundle_venta_empleado").select2();
                $("#dgplusbellebundle_venta_descuento").select2();
                $('#dgplusbellebundle_sesiones_sucursal').select2();
                $('#dgplusbellebundle_sesiones_empleado').select2();
                $('#dgplusbellebundle_sesiones_tratamiento').select2();
                $('#dgplusbellebundle_abono_sucursal').select2();
                $('#dgplusbellebundle_abono_empleado').select2();
                $('#dgplusbellebundle_imagenes_tratamiento').select2();
                $('#dgplusbellebundle_venta_tratamiento').val('').change();
                $('#busqueda-paciente').val('').change();
                $('#dgplusbellebundle_venta_nombres').val('');
                $('#dgplusbellebundle_venta_apellidos').val('');
                $('#dgplusbellebundle_venta_telefono1').val('');
                $('#dgplusbellebundle_venta_telefono2').val('');
                $('#dgplusbellebundle_venta_direccion').val('');
                $('#dgplusbellebundle_venta_correo').val('');
                $('#dgplusbellebundle_venta_dui').val('');
                $('#dgplusbellebundle_venta_ecivil').val('').change();
                $('#dgplusbellebundle_venta_sexo').val('').change();
                $('#dgplusbellebundle_venta_ocupacion').val('');
                $('#dgplusbellebundle_venta_lugar').val('');
                $('#dgplusbellebundle_venta_fechaNacimiemto').val('');
                $('#dgplusbellebundle_venta_referidopor').val('');
                $('#dgplusbellebundle_venta_nombreEmergencia').val('');
                $('#dgplusbellebundle_venta_telefonoEmergencia').val('');
                
                $("#editar-paciente").prop('disabled', true);
                $("#registro-venta").prop('disabled', true);
                
                // Al seleccionar un paciente de la busqueda
                $(document).on("change","#busqueda-paciente", function(){
                    idPac = $(this).val();
                    
                    $.ajax({
                        data:{idPac:idPac},
                        url:"{{path('busqueda_informacion_paciente')}}",
                        type: "post",
                        success: function (data) {
                            if(data.data.length!=0){
                                var nombres = ""; 
                                nombres = data.data[0].nombres+" "+ data.data[0].apellidos;
                                $('#nombrePaciente').html(nombres);

                                var telefono= '<i class="fa fa-phone"></i>';
                                if(data.data[0].telefono==null){
                                    $('#telefono').html(telefono+" N/A");
                                }
                                else{
                                    $('#telefono').html(telefono+ " "+data.data[0].telefono);
                                }

                                var direccion = '<i class="fa fa-map-marker fa-fw"></i>';
                                if(!data.data[0].direccion){
                                    $('#direccion').html(direccion+" "+data.data[0].direccion);
                                }
                                else{
                                    $('#direccion').html(direccion+' N/A');
                                }

                                var expediente ='<i class="fa fa-clipboard"></i>';
//                                $('#expediente').html(expediente + " " + data.data[0].numero);
                                $('#expediente').html('<i class=\"fa fa-clipboard\"></i> <a style=\"color:#FFF;text-decoration: underline;\" href=\"'+Routing.generate('admin_consulta_expediente_sd')+"?id="+data.data[0].numero+'\">'+data.data[0].numero+'</a>');
                                
                                var edad='<i class="fa fa-birthday-cake"></i>';
                                if(data.data[0].direccion==null){
                                    $('#edad').html(edad+" N/A");
                                }
                                else{
                                    $('#edad').html(edad+" "+data.edad);
                                }
                                
                                var fecha_nacimiento = data.data[0].fechaNacimiento;
                                fecha_nacimiento = fecha_nacimiento.split("-"); 
                                
                                $('#dgplusbellebundle_venta_nombres').val(data.data[0].nombres);
                                $('#dgplusbellebundle_venta_apellidos').val(data.data[0].apellidos);
                                $('#dgplusbellebundle_venta_telefono1').val(data.data[0].telefono);
                                $('#dgplusbellebundle_venta_telefono2').val(data.data[0].telefono2);
                                $('#dgplusbellebundle_venta_direccion').val(data.data[0].direccion);
                                $('#dgplusbellebundle_venta_correo').val(data.data[0].email);
                                $('#dgplusbellebundle_venta_dui').val(data.data[0].dui);
                                $('#dgplusbellebundle_venta_ecivil').val(data.data[0].estadoCivil).change();
                                $('#dgplusbellebundle_venta_sexo').val(data.data[0].sexo).change();
                                $('#dgplusbellebundle_venta_ocupacion').val(data.data[0].ocupacion);
                                $('#dgplusbellebundle_venta_lugar').val(data.data[0].lugarTrabajo);
                                $('#dgplusbellebundle_venta_fechaNacimiemto').val(fecha_nacimiento[2] + '-' + fecha_nacimiento[1] + '-' + fecha_nacimiento[0]);
                                $('#dgplusbellebundle_venta_referidopor').val(data.data[0].referidoPor);
                                $('#dgplusbellebundle_venta_nombreEmergencia').val(data.data[0].personaEmergencia);
                                $('#dgplusbellebundle_venta_telefonoEmergencia').val(data.data[0].telefonoEmergencia);
                                
                                $("#editar-paciente").prop('disabled', false);
                                $("#registro-venta").prop('disabled', false);
                                
                                var infoPaciente = document.getElementById('info-Paciente');                                
                                infoPaciente.style.display = 'block';
                            }
                        }
                    });
                });
                
                // Estableciendo la máscara a los campos que lo requieren
                $('#dgplusbellebundle_venta_dui').mask('00000000-0');  
                $('#dgplusbellebundle_venta_telefono1').mask('0000-0000'); 
                $('#dgplusbellebundle_venta_telefono2').mask('0000-0000'); 
                $('#dgplusbellebundle_venta_telefonoEmergencia').mask('0000-0000');
                
                $('#registro-venta').attr("disabled", false);
                
                //
                $('.calZebra').Zebra_DatePicker({
                    months:['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                    days: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
                    format: 'd-m-Y',
                    show_clear_date:false,
                    show_select_today: "Hoy",
                });
                
                // Al hacer click en la opcion de tipo de venta de paquete
                $(document).on("click","#tipo-venta-paquete", function(){
                    var ventaPaquete = document.getElementById('venta-paquete');
                    var ventaTratamiento = document.getElementById('venta-tratamiento');
                    var ventaSucursal = document.getElementById('sucursal-venta');
                    var empleadosVenta = document.getElementById('empleados-venta');
                    var sesionesTratamiento = document.getElementById('sesiones-tratamiento');
                    var costoVenta = document.getElementById('costo-venta');
                    var descuentoVenta = document.getElementById('descuento-venta');
                    var cuotasVenta = document.getElementById('cuotas-venta');
                    var registrarVenta = document.getElementById('registrar-venta');
                    //var observaciones = document.getElementById('vventa-observaciones');
                    
                    ventaPaquete.style.display = 'block';
                    ventaTratamiento.style.display = 'none';
                    ventaSucursal.style.display = 'block';
                    empleadosVenta.style.display = 'block';
                    sesionesTratamiento.style.display = 'none';
                    costoVenta.style.display = 'block';
                    descuentoVenta.style.display = 'block';
                    cuotasVenta.style.display = 'block';
                    registrarVenta.style.display = 'block';
                    //observaciones.style.display = 'block';
                    
                    $('#dgplusbellebundle_venta_costo').val('');
                    $('#dgplusbellebundle_venta_cuotas').val('');
                    $('#dgplusbellebundle_venta_descuento').val('');
                    $('#dgplusbellebundle_venta_paquete').val('');
                    $('#vventa-observaciones').show();
                });
                
                // Al hacer click en la opcion de tipo de venta de tratamiento
                $(document).on("click","#tipo-venta-tratamiento", function(){
                    var ventaPaquete = document.getElementById('venta-paquete');
                    var ventaTratamiento = document.getElementById('venta-tratamiento');
                    var ventaSucursal = document.getElementById('sucursal-venta');
                    var empleadosVenta = document.getElementById('empleados-venta');
                    var sesionesTratamiento = document.getElementById('sesiones-tratamiento');
                    var costoVenta = document.getElementById('costo-venta');
                    var descuentoVenta = document.getElementById('descuento-venta');
                    var cuotasVenta = document.getElementById('cuotas-venta');
                    var registrarVenta = document.getElementById('registrar-venta');
                    var tratamientosPaquete = document.getElementById('tratamientos-paquete');
                    //var observaciones = document.getElementById('vventa_observaciones');
                    
                    ventaPaquete.style.display = 'none';
                    ventaTratamiento.style.display = 'block';
                    ventaSucursal.style.display = 'block';
                    empleadosVenta.style.display = 'block';
                    sesionesTratamiento.style.display = 'block';
                    costoVenta.style.display = 'block';
                    descuentoVenta.style.display = 'block';
                    cuotasVenta.style.display = 'block';
                    registrarVenta.style.display = 'block';
                    tratamientosPaquete.style.display = 'none';
                    //observaciones.style.display = 'block';
                    
                    $('#dgplusbellebundle_venta_costo').val('');
                    $('#dgplusbellebundle_venta_cuotas').val('');
                    $('#dgplusbellebundle_venta_descuento').val('');
                    $('#dgplusbellebundle_venta_tratamiento').val('');
                    $('#vventa-observaciones').show();
                });
                
                // Al seleccionar un paquete
                $(document).on("change","#dgplusbellebundle_venta_paquete", function(){
                    var tratamientosPaquete = document.getElementById('tratamientos-paquete');
                    var draw = '';
                    var id = $(this).val();
                    var data = {
                                  id : id,
                              };
                              
                    $.ajax({
                        data:  data,
                        url:   '{{path('admin_costo_paquete')}}',
                        type:  'post',
                        success:  function (response) {
                            $('#dgplusbellebundle_venta_costo').val(response.data.regs);
                            
                            draw+='<hr>';
                            draw+='<div class="row">';
                            draw+='<div class="col-md-8">';
                            draw+='<p class="text-center"><strong>Nombre del tratamiento</strong></p>';
                            draw+='</div>';
                            draw+='<div class="col-md-4">';
                            draw+='<p class="text-center"><strong># de sesiones</strong></p>';
                            draw+='</div>';
                            draw+='</div>';
                            draw+='<hr>';
                            $.each( response.paqueteTrat, function( key, value ) {
                                draw+='<div class="row">';
                                draw+='<div class="col-md-8" style="margin-top: 5px;">';
                                draw+='<label>' + value.Nombretrat + '</label>';
                                draw+='</div>';
                                draw+='<div class="col-md-4" style="margin-top: 5px;">';
                                draw+='<input type="text" name="dgplusbellebundle_venta[paqueteTrat][' + value.id + ']" id="dgplusbellebundle_venta_paqueteTrat_' + value.id + '" class="form-control sesionesPaqueteTrata" style="width: 100%" value="' + value.sesiones + '">';
                                draw+='</div>';
                                draw+='</div>';
                                
                            });
                            draw+='<hr>';
                            document.getElementById('tratamientos-paquete').innerHTML = draw;  
                            $('#hr-tratamientos-paquete').show();
                            tratamientosPaquete.style.display = 'block';
                        }
                    });
                });
                
                // Al seleccionar un tratamiento
                $(document).on("change","#dgplusbellebundle_venta_tratamiento", function(){
                    var id = $(this).val();
                    var data = {
                                  id : id,
                              };
                              
                     $.ajax({
                        data:  data,
                        url:   '{{path('admin_costo_tratamiento')}}',
                        type:  'post',
                        success:  function (response) {
                            $('#dgplusbellebundle_venta_costo').val(response.data.regs);
                        }
                    });
                });
                
                // Al momento de hacer click en Registrar informacion del paciente
                $(document).on("click", "#editar-paciente", function(){
                    var nombres = $('#dgplusbellebundle_venta_nombres').val();
                    var apellidos = $('#dgplusbellebundle_venta_apellidos').val();
                    var telefono = $('#dgplusbellebundle_venta_telefono1').val();
                    var telefono2 = $('#dgplusbellebundle_venta_telefono2').val();
                    var direccion = $('#dgplusbellebundle_venta_direccion').val();
                    var correo = $('#dgplusbellebundle_venta_correo').val();
                    var dui = $('#dgplusbellebundle_venta_dui').val();
                    var ecivil = $('#dgplusbellebundle_venta_ecivil').val();
                    var sexo = $('#dgplusbellebundle_venta_sexo').val();
                    var ocupacion = $('#dgplusbellebundle_venta_ocupacion').val();
                    var lugarTrabajo = $('#dgplusbellebundle_venta_lugar').val();
                    var fechaNacimiento = $('#dgplusbellebundle_venta_fechaNacimiemto').val();
                    var referidoPor = $('#dgplusbellebundle_venta_referidopor').val();
                    var personaEmergencia = $('#dgplusbellebundle_venta_nombreEmergencia').val();
                    var telefonoEmergencia = $('#dgplusbellebundle_venta_telefonoEmergencia').val();
                
                    var data = {
                                  id : idPac,
                                  nombres : nombres,
                                  apellidos : apellidos,
                                  telefono : telefono,
                                  telefono2 : telefono2,
                                  direccion : direccion,
                                  correo : correo,
                                  dui : dui,
                                  ecivil : ecivil,
                                  sexo : sexo,
                                  ocupacion : ocupacion,
                                  lugarTrabajo : lugarTrabajo,
                                  fechaNacimiento : fechaNacimiento,
                                  referidoPor : referidoPor,
                                  personaEmergencia : personaEmergencia,
                                  telefonoEmergencia : telefonoEmergencia
                              };
                              
                     $.ajax({
                        data:  data,
                        url:   '{{path('admin_registro_datos_generales_paciente')}}',
                        type:  'post',
                        success:  function (response) {
                            var iTel='<i class="fa fa-phone"></i>';
                            var dir='<i class="fa fa-map-marker fa-fw"></i>';
                            
                            $('#telefono').html(iTel+" " + telefono);
                            $('#direccionD').html(dir+" " + direccion);
                            $('#nombrePaciente').html(nombres + " " + apellidos);
                            
                            swal('','Datos del paciente actualizados!','success');                            
                        }
                    });
                    
                    return false;
                });
                
                // Al momento de hacer click en Registrar venta 
                $(document).on("click", "#registro-venta", function(){
                    var idpac = idPac;
                    var paquete = $('#dgplusbellebundle_venta_paquete').val();
                    var tratamiento = $('#dgplusbellebundle_venta_tratamiento').val();
                    var sucursal = $('#dgplusbellebundle_venta_sucursal').val();
                    var descuento = $('#dgplusbellebundle_venta_descuento').val();
                    var empleado = $('#dgplusbellebundle_venta_empleado').val();
                    var costo = $('#dgplusbellebundle_venta_costo').val();
                    var cuotas = $('#dgplusbellebundle_venta_cuotas').val();
                    var observaciones = $('#dgplusbellebundle_venta_observaciones').val();
                    var sesiones = '';
                    var sesionesPaqueteTrata = new Array();
                    var tratamientos = new Array();
                    var flag = 0;
                    var draw = '';
                    var listadoSesiones1 = document.getElementById('listadoPaquete');
                    var listadoSesiones2 = document.getElementById('listadoTratamiento');
                    
                    // Se verifica que se haya seleccionado un paciente
                    if(idpac > 0) {
                        // Si se ha chequeado en el tipo de venta Paquete
                        if($("#tipo-venta-paquete").is(':checked')) {
                            if(paquete != null){
                                if(sucursal != null){
                                    if(costo.length > 0){
                                        if(cuotas > 0){
                                            var aux = 0;

                                            $('.sesionesPaqueteTrata').each(function( key, value ) {
                                                if($(this).val() > 0){
                                                    var elemento = $(this).attr('id');
                                                    var res = elemento.split("_"); 
                                                    var lastEl = res[res.length-1];

                                                    tratamientos.push(lastEl); 
                                                    sesionesPaqueteTrata.push($(this).val()); 
                                                }

                                                if(!$(this).val()){
                                                    aux++; 
                                               }
                                            });
                                            if(aux < 1) {
                                            // Se obtiene la informacion necesaria para registrar la venta
                                                var data = {
                                                    id : idpac,
                                                    paquete : paquete,
                                                    sucursal : sucursal,
                                                    empleado: empleado,
                                                    costo : costo,
                                                    descuento : descuento,
                                                    cuotas : cuotas,
                                                    observaciones : observaciones,
                                                    tratamientos : tratamientos,
                                                    sesiones : sesionesPaqueteTrata,
                                                };

                                                // Se procede a registrar la venta del paquete mediante ajax
                                                $.ajax({
                                                    data:  data,
                                                    url:   '{{path('admin_registro_nueva_venta_paquete')}}',
                                                    type:  'post',
                                                    success:  function (response) {
                                                        swal('','Venta de paquete registrada!','success');
                                                        $('#num-label-ses').hide();

                                                        var tabsAbdev = document.getElementById('tabs-abdev');
                                                        var seguimientoSesionesTratamiento = document.getElementById('seguimiento-sesiones-tratamiento');
                                                        var detalleVentaInfo = document.getElementById('detalle-venta-info');
                                                        var tabsSeguimiento = document.getElementById('tabs-seguimiento');
                                                        tabsSeguimiento.style.display = 'block';
                                                        var totalpagar = response.ventaPaqueteTratamientos.costo - response.ventaPaqueteTratamientos.descuento;

                                                        var costpVenta = response.ventaPaqueteTratamientos.costo - 0;

                                                        id_ventapaquete = response.ventaPaquete;
                                                        deuda_total = totalpagar.toFixed(2);

                                                        var costpVenta = response.ventaPaqueteTratamientos.costo - 0;
                                                        costpVenta = costpVenta.toFixed(2);

                                                        // Se guarda el select que será utilizado para el llenado de tratamientos
                                                        var vtratamientos = $("#dgplusbellebundle_sesiones_tratamiento");

                                                        $('#detalle-venta-costo').html('$ ' + costpVenta);
                                                        $('#detalle-venta-cuotas').html(response.ventaPaqueteTratamientos.cuotas);
                                                        $('#detalle-venta-deuda').html('$ ' + deuda_total);

                                                        $('#label-tipo-venta').html('<p> Paquete</p>');
                                                        $('#venta-paquete').html('<label>Paquete</label><p>' + response.paquete + '</p>');

                                                        var url = "{{path('admin_sesiones_paciente_data_paquete')}}"+'?id='+id_ventapaquete;
                                                        table1.ajax.url(url).load();
                                                        listadoSesiones1.style.display = 'block';


                                                        $.each( response.ventaPaqueteTratamientos.nomTratamientos, function( key, value ) {
                                                            draw+= '<div class="row">';
                                                            draw+= '<div class="col-md-5" style="margin-bottom: 10px;">';
                                                            draw+= '<span>' + value + '</span>';
                                                            draw+= '</div>';
                                                            draw+= '<div class="col-md-7" style="margin-bottom: 10px;">';
                                                            draw+= '<div class="row">';

                                                            for (i = 0; i < response.ventaPaqueteTratamientos.sesiones[key]; i++) {
                                                                draw+= '<div class="col-md-1" style="margin-bottom: 10px;">';
                                                                draw+= '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                                                draw+= '</div>';
                                                            }

                                                            draw+= '</div>';
                                                            draw+= '</div>';
                                                            draw+= '</div>';
                                                        });

                                                        $('#detalle-venta-tratamientos').html(draw);

                                                        // LLenado del combobox de tratamientos de la sección de registro de sesiones
                                                        // con los tratamientos que pertenecen al paquete que se le ha realizado la
                                                        // la venta
                                                        $(response.ventaPaqueteTratamientos.tratVenta).each(function(i, v){ 
                                                            vtratamientos.append('<option value="' + v.id + '">' + v.nombre + '</option>');
                                                        });

                                                        var imgtratamientos = $("#dgplusbellebundle_imagenes_tratamiento");
                                                        $(response.ventaPaqueteTratamientos.tratVenta).each(function(i, v){ 
                                                            imgtratamientos.append('<option value="' + v.id + '">' + v.nombre + '</option>');
                                                        });

                                                        $("#dgplusbellebundle_imagenes_tratamiento").show();

                                                        tabsAbdev.style.display = 'block';
                                                        seguimientoSesionesTratamiento.style.display = 'block';
                                                        detalleVentaInfo.style.display = 'block';

                                                        $('#registro-venta').attr("disabled", true);

                                                        var registrarVenta = document.getElementById('registrar-venta');
                                                        registrarVenta.style.display = 'none';

                                                        var editarVenta = document.getElementById('modificar-venta');
                                                        editarVenta.style.display = 'block';
                                                    }
                                                });

                                                return false;
                                            } else {
                                                swal('','Debe de ingresar las sesiones para todos los tratamientos del paquete!','error');
                                                return false;
                                            }                                       
                                        } else {
                                            swal('','Ingrese un numero de cuotas valido!','error');
                                            $( "#dgplusbellebundle_venta_cuotas" ).focus();
                                            return false;
                                        }
                                    } else {
                                        swal('','Ingrese el valor de la venta ($)!','error');
                                        $( "#dgplusbellebundle_venta_costo" ).focus();
                                        return false;
                                    }
                                } else {
                                    swal('','Seleccione una sucursal!','error');
                                    return false;
                                }
                            } else {
                                swal('','Seleccione el paquete que desea vender!','error');
                                return false;
                            }    

                        // Si se ha chequeado en el tipo de venta Tratamiento    
                        } else {
                            sesiones = $('#dgplusbellebundle_venta_sesiones').val();

                            if(tratamiento != null){
                                if(sucursal != null){
                                    if(costo.length > 0){
                                        if(cuotas > 0){
                                            if(sesiones > 0){
                                                // Se obtiene la informacion necesaria para registrar la venta
                                                var data = {
                                                    id : idpac,
                                                    tratamiento : tratamiento,
                                                    sucursal : sucursal,
                                                    empleado: empleado,
                                                    costo : costo,
                                                    descuento : descuento,
                                                    cuotas : cuotas,
                                                    observaciones : observaciones,
                                                    sesiones : sesiones,
                                                };

                                                // Se procede a registrar la venta del tratamiento mediante ajax
                                                $.ajax({
                                                    data:  data,
                                                    url:   '{{path('admin_registro_nueva_venta_tratamiento')}}',
                                                    type:  'post',
                                                    success:  function (response) {
                                                        swal('','Venta de tratamiento registrada!','success');

                                                        var tabsAbdev = document.getElementById('tabs-abdev');
                                                        var detalleVentaInfo = document.getElementById('detalle-venta-info');
                                                        var costoTratamiento = response.personaTratamiento.costo;
                                                        var tabsSeguimiento = document.getElementById('tabs-seguimiento');
                                                        tabsSeguimiento.style.display = 'block';
                                                        id_ventatratamiento = response.personaTratamiento.id;
                                                        deuda_total = (response.personaTratamiento.costo - ((response.personaTratamiento.descuento * response.personaTratamiento.costo)/100) - response.abonos.abonos).toFixed(2);
                                                        var costpVenta = response.personaTratamiento.costo - 0;
                                                        costpVenta = costpVenta.toFixed(2);

                                                        $('#detalle-venta-costo').html('$ ' + costpVenta);
                                                        $('#detalle-venta-cuotas').html(response.personaTratamiento.cuotas);
                                                        $('#detalle-venta-deuda').html('$ ' + deuda_total);

                                                        $('#detalle-venta-sesiones').html(response.personaTratamiento.sesiones);

                                                        $('#label-tipo-venta').html('<p>Tratamiento</p>');
                                                        $('#venta-tratamiento').html('<label>Tratamiento</label><p>' + response.tratamiento + '</p>');

                                                        var url2 = "{{path('admin_sesiones_paciente_data_tratamiento')}}"+'?id='+id_ventatratamiento;
                                                        table2.ajax.url(url2).load();
                                                        listadoSesiones2.style.display = 'block';

                                                        draw+= '<div class="row">';
                                                        draw+= '<div class="col-md-5" style="margin-bottom: 10px;">';
                                                        draw+= '<span>' + response.tratamiento + '</span>';
                                                        draw+= '</div>';
                                                        draw+= '<div class="col-md-7" style="margin-bottom: 10px;">';
                                                        draw+= '<div class="row" id ="seguimiento-tratamientos-realizados">';

                                                        pendientes = response.personaTratamiento.sesiones;

                                                        for (i = 0; i < response.personaTratamiento.sesiones; i++) {
                                                            draw+= '<div class="col-md-1" style="margin-bottom: 10px;">';
                                                            draw+= '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                                            draw+= '</div>';
                                                        }

                                                        draw+= '</div>';
                                                        draw+= '</div>';
                                                        draw+= '</div>';

                                                        $('#detalle-venta-tratamientos').html(draw);

                                                        tabsAbdev.style.display = 'block';
                                                        detalleVentaInfo.style.display = 'block';

                                                        var registrarVenta = document.getElementById('registrar-venta');
                                                        registrarVenta.style.display = 'none';

                                                        var editarVenta = document.getElementById('modificar-venta');
                                                        editarVenta.style.display = 'block';

                                                        $('#registro-venta').attr("disabled", true);
                                                        $("#imagenes-sesiones-tratamiento").hide();                                                    
                                                    }
                                                });
                                                return false;
                                            } else {
                                                $( "#dgplusbellebundle_venta_cuotas" ).focus();
                                                swal('','Ingrese la cantidad de sesiones de tratamientos!','error');
                                                return false;
                                            }
                                        } else {
                                            swal('','Ingrese un numero de cuotas valido!','error');
                                            $( "#dgplusbellebundle_venta_cuotas" ).focus();
                                            return false;
                                        }
                                    } else {
                                        swal('','Ingrese el valor de la venta!','error');
                                        $( "#dgplusbellebundle_venta_costo" ).focus();
                                        return false;
                                    }
                                } else {
                                    swal('','Seleccione la sucursal donde se realiza la venta!','error');
                                    return false;
                                }
                            } else {
                                swal('','Seleccione el tratamiento que desea vender!','error');
                                return false;
                            } 
                        }    
                    } else {
                        swal('','Debe de seleccionar un paciente para registrar la venta!','error');
                        return false;
                    } 
                    
//                    console.log(id_ventatratamiento);
                    return false;
                });
                
                
                // Al momento de hacer click en Editar venta 
                $(document).on("click", "#edit-venta", function(){
                    // Si se ha chequeado en el tipo de venta Paquete
                    if(id_ventapaquete > 0) {
                        var idpac = idPac;
                        var paquete = $('#dgplusbellebundle_venta_paquete').val();
                        var tratamiento = $('#dgplusbellebundle_venta_tratamiento').val();
                        var sucursal = $('#dgplusbellebundle_venta_sucursal').val();
                        var descuento = $('#dgplusbellebundle_venta_descuento').val();
                        var empleado = $('#dgplusbellebundle_venta_empleado').val();
                        var costo = $('#dgplusbellebundle_venta_costo').val();
                        var cuotas = $('#dgplusbellebundle_venta_cuotas').val();
                        var observaciones = $('#dgplusbellebundle_venta_observaciones').val();
                        var sesiones = '';
                        var sesionesPaqueteTrata = new Array();
                        var tratamientos = new Array();
                        var flag = 0;
                        var draw = '';
                        var mensaje = '';

                        if(sucursal != null){
                            if(costo.length > 0){
                                if(cuotas > 0){
                                    var aux = 0;
                                        
                                    $('.sesionesPaqueteTrata').each(function( key, value ) {
                                        if($(this).val() > 0){
                                            var elemento = $(this).attr('id');
                                            var res = elemento.split("_"); 
                                            var lastEl = res[res.length-1];

                                            tratamientos.push(lastEl); 
                                            sesionesPaqueteTrata.push($(this).val()); 
                                        }

                                        if(!$(this).val()){
                                            aux++; 
                                       }
                                    });

                                    if(aux < 1) {
                                        // Se obtiene la informacion necesaria para registrar la venta
                                        var data = {
                                            id : idpac,
                                            paquete : paquete,
                                            sucursal : sucursal,
                                            empleado: empleado,
                                            costo : costo,
                                            descuento : descuento,
                                            cuotas : cuotas,
                                            observaciones : observaciones,
                                            tratamientos : tratamientos,
                                            sesiones : sesionesPaqueteTrata,
                                            id_ventapaquete : id_ventapaquete
                                        };

                                        // Se procede a registrar la venta del paquete mediante ajax
                                        $.ajax({
                                            data:  data,
                                            url:   '{{path('admin_registro_editar_venta_paquete')}}',
                                            type:  'post',
                                            success:  function (response) {
                                                swal('','Venta de paquete actualizada!','success');
                                                var seguimientoSesionesTratamiento = document.getElementById('seguimiento-sesiones-tratamiento');
                                                var detalleVentaInfo = document.getElementById('detalle-venta-info');
                                                id_ventapaquete = response.ventaPaquete;
                                                deuda_total = (response.ventaPaqueteTratamientos.costo - ((response.ventaPaqueteTratamientos.descuento * response.ventaPaqueteTratamientos.costo)/100) - response.abonos.abonos).toFixed(2);

                                                $('#detalle-venta-costo').html('$ ' + response.ventaPaqueteTratamientos.costo);
                                                $('#detalle-venta-cuotas').html(response.ventaPaqueteTratamientos.cuotas);
                                                $('#detalle-venta-deuda').html('$ ' + deuda_total);
                                                
                                                $.each( response.ventaPaqueteTratamientos.ventaPaquete, function( key, value ) {
                                                    mensaje+= '<div class="row">';
                                                    mensaje+= '<div class="col-md-5" style="margin-bottom: 10px;">';
                                                    mensaje+= '<span>' + value.ntrata + '</span>';
                                                    mensaje+= '</div>';
                                                    mensaje+= '<div class="col-md-7" style="margin-bottom: 10px;">';
                                                    mensaje+= '<div class="row">';

                                                    if(value.numSesion == 0){
                                                        for (var i = 0; i < value.sesiones; i++) {
                                                            mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                                            mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                                            mensaje += '</div>';
                                                        }    
                                                    } else {
                                                        for (var i = 0; i < value.numSesion; i++) {
                                                            mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                                            mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_realizada.png')}}" title="Sesion realizada">';
                                                            mensaje += '</div>';
                                                        }
                                                        for (var i = 0; i < value.sesiones - value.numSesion; i++) {
                                                            mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                                            mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                                            mensaje += '</div>';
                                                        }
                                                    }

                                                    mensaje+= '</div>';
                                                    mensaje+= '</div>';
                                                    mensaje+= '</div>';
                                                });

                                                $('#detalle-venta-tratamientos').html(mensaje);
                                            }
                                        });

                                        return false;
                                    } else {
                                        swal('','Debe de ingresar las sesiones para todos los tratamientos del paquete!','error');
                                        return false;
                                    }  

                                } else {
                                    swal('','Ingrese un numero de cuotas valido!','error');
                                    $( "#dgplusbellebundle_venta_cuotas" ).focus();
                                    return false;
                                }
                            } else {
                                swal('','Ingrese el valor de la venta!','error');
                                $( "#dgplusbellebundle_venta_costo" ).focus();
                                return false;
                            }
                        } else {
                            swal('','Seleccione la sucursal donde se realiza la venta!','error');
                            return false;
                        }

                        return false;
                        
                    // Si se ha chequeado en el tipo de venta Tratamiento    
                    } else {
                        var idpac = idPac;
                        var paquete = $('#dgplusbellebundle_venta_paquete').val();
                        var tratamiento = $('#dgplusbellebundle_venta_tratamiento').val();
                        var sucursal = $('#dgplusbellebundle_venta_sucursal').val();
                        var descuento = $('#dgplusbellebundle_venta_descuento').val();
                        var empleado = $('#dgplusbellebundle_venta_empleado').val();
                        var costo = $('#dgplusbellebundle_venta_costo').val();
                        var cuotas = $('#dgplusbellebundle_venta_cuotas').val();
                        var sesiones = $('#dgplusbellebundle_venta_sesiones').val();
                        var observaciones = $('#dgplusbellebundle_venta_observaciones').val();
                        var sesionesPaqueteTrata = new Array();
                        var tratamientos = new Array();
                        var flag = 0;
                        var draw = '';

                        if(sucursal != null){
                            if(costo.length > 0){
                                if(cuotas > 0){
                                    if(sesiones > 0){
                                        // Se obtiene la informacion necesaria para registrar la venta
                                        var data = {
                                            id : idpac,
                                            tratamiento : tratamiento,
                                            sucursal : sucursal,
                                            empleado: empleado,
                                            costo : costo,
                                            descuento : descuento,
                                            cuotas : cuotas,
                                            observaciones : observaciones,
                                            sesiones : sesiones,
                                            id_personatratamiento : id_ventatratamiento
                                        };
                                        
                                        // Se procede a registrar la venta del tratamiento mediante ajax
                                        $.ajax({
                                            data:  data,
                                            url:   '{{path('admin_registro_editar_venta_tratamiento')}}',
                                            type:  'post',
                                            success:  function (response) {
                                                swal('','Venta de tratamiento registrada!','success');
                                        
                                                var tabsImagenes = document.getElementById('tabs-imagenes');
                                                var tabsAbdev = document.getElementById('tabs-abdev');
                                                var detalleVentaInfo = document.getElementById('detalle-venta-info');
                                                var costoTratamiento = response.personaTratamiento.costo;
                                                id_ventatratamiento = response.personaTratamiento.id;
                                                var mensaje = '';
                                                console.log(response.personaTratamiento.descuento);
                                                deuda_total = (response.personaTratamiento.costo - ((response.personaTratamiento.descuento * response.personaTratamiento.costo)/100) - response.abonos.abonos).toFixed(2);
                                                
                                                $('#detalle-venta-costo').html('$ ' + costoTratamiento);
                                                $('#detalle-venta-deuda').html('$ ' + deuda_total);
                                                $('#detalle-venta-cuotas').html(response.personaTratamiento.cuotas);
                                                $('#detalle-venta-sesiones').html(response.personaTratamiento.sesiones);

                                                for (var i = 0; i < response.seguimiento; i++) {
                                                    mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                                    mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_realizada.png')}}" title="Sesion realizada">';
                                                    mensaje += '</div>';
                                                }
                                                for (var i = 0; i < response.personaTratamiento.sesiones - response.seguimiento; i++) {
                                                    mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                                    mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                                    mensaje += '</div>';
                                                }

                                                $('#seguimiento-tratamientos-realizados').html(mensaje);

                                            }
                                        });
                                        return false;
                                    } else {
                                        swal('','Ingrese la cantidad de sesiones de tratamieto!','error');
                                        $( "#dgplusbellebundle_venta_cuotas" ).focus();
                                        return false;
                                    }
                                } else {
                                    swal('','Ingrese un numero de cuotas valido!','error');
                                    $( "#dgplusbellebundle_venta_cuotas" ).focus();
                                    return false;
                                }
                            } else {
                                swal('','Ingrese el valor de la venta!','error');
                                $( "#dgplusbellebundle_venta_costo" ).focus();
                                return false;
                            }
                        } else {
                            swal('','Seleccione la sucursal donde se realiza la venta!','error');                            
                            return false;
                        }


                        return false;
                    }    
                });
                
                // Al momento de hacer click en Registrar nueva sesion de tratamiento 
                $(document).on("click", "#registrar-sesiones-tratamiento", function(){
                    var sucursal = $('#dgplusbellebundle_sesiones_sucursal').val();
                    var empleado = $('#dgplusbellebundle_sesiones_empleado').val();
                    var sesionesPaqueteTrata = new Array();
                    var tratamientos = new Array();
                    var flag = 0;
                    $("#registro-sesiones-tratamiento").prop('disabled', true);
                    
                    if(id_ventapaquete > 0) {
                        $.post( "{{path('admin_evaluar_sesiones_paquete')}}", { id: id_ventapaquete }, function( data ) {
                            var aux = 0;
                            var total = data.query.length;

                            // Calculando la deuda pendiente que tiene el paciente en el paquete seleccionado
                            var deuda = ( (data.query[0].costoPaquete - ((data.query[0].porcentaje * data.query[0].costoPaquete)/100)) - data.abonos.abonos).toFixed(2);

                            $.each( data.query, function( key, value ) {
                               if(parseInt(value.numSesion) >= parseInt(value.sesiones)){
                                    aux = aux + 1;
                                }
                            });   
                            
                            // Si exiten sesiones pendientes
                            if(aux < total){
                                // Si el paciente no tiene deuda pendiente en el paquete seleccionado
                                if(deuda <= 0){
                            
                                    var tratamiento = $('#dgplusbellebundle_sesiones_tratamiento').val();

                                    var datos = {
                                        id : id_ventapaquete,
                                        sucursal : sucursal,
                                        empleado: empleado,
                                        tratamiento: tratamiento
                                    };
                                    
                                    console.log(datos);
                                    
                                    nuevaSesionPaqueteTratamiento(datos);
                                    return false;
                                    
                                // Si el paciente tiene deuda pendiente en el paquete seleccionado        
                                } else {
                                    bootbox.confirm({ title: 'Confirmación de registro de nueva sesión',
                                        message: 'El paciente tiene  una deuda de $' + deuda + ', en éste paquete ¿Desea continuar?',
                                        buttons: {
                                            'cancel': {
                                                label: 'Cancelar',
                                                className: 'btn-default pull-left'
                                            },
                                            'confirm': {
                                                label: 'Aceptar',
                                                className: 'btn-primary pull-right'
                                            }
                                        },
                                        callback: function(result) {
                                            // Si acepta continuar con el registro de una nueva sesion de tratamiento
                                            if(result == true){
                                                var tratamiento = $('#dgplusbellebundle_sesiones_tratamiento').val();

                                                var datos = {
                                                    id : id_ventapaquete,
                                                    sucursal : $('#dgplusbellebundle_sesiones_sucursal').val(),
                                                    empleado: $('#dgplusbellebundle_sesiones_empleado').val(),
                                                    tratamiento: tratamiento
                                                };
                                                
                                                nuevaSesionPaqueteTratamiento(datos);
                                                return false;                                                
                                            } else {
                                                $("#registro-sesiones-tratamiento").prop('disabled', false);
                                            }
                                        }
                                    });
                                }
                            } else {
                                swal('','Se han completado las sesiones, no se pueden registrar más para este paquete!','error');
                            }
                            
                        }, "json"); // Fin de post        
                    } else if(id_ventatratamiento > 0){
                        if(pendientes > 0){
                            // Se obtiene la informacion necesaria para registrar la sesion
                            var data = {
                                id : id_ventatratamiento,
                                sucursal : sucursal,
                                empleado: empleado
                            };

                            // Se procede a registrar la sesion del tratamiento mediante ajax
                            $.ajax({
                                data:  data,
                                url:   '{{path('admin_sesionventatratamiento_nuevo')}}',
                                type:  'post',
                                success:  function (response) {
                                    swal('','Sesión de tratamiento registrada!','success');
                                    var mensaje = '';
                                    var tabsImagenes = document.getElementById('tabs-imagenes');
                                    tabsImagenes.style.display = 'block';

                                    $('#idSesion').val(id_ventatratamiento);
                                    
                                    pendientes--;
                                    for (var i = 0; i < response.seguimiento; i++) {
                                        mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                        mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_realizada.png')}}" title="Sesion realizada">';
                                        mensaje += '</div>';
                                    }
                                    for (var i = 0; i < response.personaTratamiento.sesiones - response.seguimiento; i++) {
                                        mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                        mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                        mensaje += '</div>';
                                    }

                                    table2.ajax.reload();
                                    $("#registro-sesiones-tratamiento").prop('disabled', false);
                                    $('#seguimiento-tratamientos-realizados').html(mensaje);
                                    
                                    $('#dgplusbellebundle_sesiones_sucursal').val('').change();
                                    $('#dgplusbellebundle_sesiones_empleado').val('').change();
                                }
                            });

                            return false;
                        } else {
                            swal('','Se han completado las sesiones, no se pueden registrar más para este tratamiento!','error');
                            return false;
                        }    
                    } else {
                        swal('','No se puede realizar esta operación. No existe una venta relacionda!','error');
                        return false;
                    } 
                    
                    return false;
                });
                
                // Al hacer click en guardar imagenes
                $(document).on("click","#registro-sesiones-imagenes",function(){
                    // Si se ha chequeado en el tipo de venta Paquete
                    if(id_ventapaquete > 0) {
                        $("#prev").show();
                        $("#saveImagen").hide();

                        //obtenemos un array con los datos del archivo
                        var file = $('#file-input')[0].files[0];
                        //obtenemos el nombre del archivo
                        var idSesion =$('#idSesion').val();
                        var tratamiento = $('#dgplusbellebundle_imagenes_tratamiento').val();
                        var fileName = file.name;
                        //obtenemos la extensión del archivo
                        fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1);
                        //obtenemos el tamaño del archivo
                        var fileSize = file.size;

                        //obtenemos el tipo de archivo image/png ejemplo
                        var fileType = file.type;
                        
                        if (fileExtension == 'PNG' || fileExtension == 'png' ||fileExtension == 'JPG'|| fileExtension == 'jpg' && fileType =='imagen' || fileType =='image' || fileType =='image/jpeg' )
                        {
                            flag = true;
                        }else{
                            flag = false;
                        }
                        if(idSesion!=''){
                            if (flag==false){
                                alert("Archivo invalido, seleccione una imagen.");
                                $("#file-input").val("");
                                $("#prev").hide();
                                $("#saveImagen").hide();
                            }else{  
                               var pesoKb=(fileSize/1024);
                               if (pesoKb<=6144){
                                var frm = new FormData($("#formImagen")[0]);
                                console.log(frm);
                                    if (flag != false) {
                                        $.ajax({
                                            data:frm,
                                            url:Routing.generate('ingresar_foto_venta_paquete'),
                                            type: 'POST',
                                            dataType: 'json',
                                            cache: false,
                                            contentType: false,
                                            processData: false,
                                            success: function(data){
                                                if(data.exito == 0){
                                                    $('#file-input').val('');
                                                    swal('','Imágenes subidas!','success');
                                                    $('#listadoImagenes').html('');
                                                    var key = 1;
                                                    for(i=0;i<data.imagenes.length;i++){
                                                        $('#listadoImagenes').append('<div class=\"col-md-2\"><a class=\"verImagen\" href=\"{{ asset('Photos/Tmp/')}}'+data.imagenes[i]+'\"><img style=\"width:100%;\" src=\"{{ asset('Photos/Tmp/')}}' + data.imagenes[i] + '\"></a></div>');
                                                        key++;
                                                    }
                                                } else {
                                                    swal('','Debe guardar una sesión de tratamiento del paquete!','error');
                                                    return false;
                                                }
                                            },
                                            error: function(data){
                                                swal('','Hubo un error al subir las fotos!','error');
                                            }
                                        });
                                    }
                                }
                                else{
                                    swal('','Imagen demasiado grande, intente con una más pequeña!','success');
                                }
                            }
                        }
                        else{
                            swal('','Debe guardar una sesión de tratamiento del paquete!','error');
                        }
                    // Si se ha chequeado en el tipo de venta Tratamiento    
                    } else {
                        $("#prev").show();
        
                        $("#saveImagen").hide();

                        //obtenemos un array con los datos del archivo
                        var file = $('#file-input')[0].files[0];
                        //obtenemos el nombre del archivo
                        var idSesion =$('#idSesion').val();

                        var fileName = file.name;
                        //obtenemos la extensión del archivo
                        fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1);
                        //obtenemos el tamaño del archivo
                        var fileSize = file.size;

                        //obtenemos el tipo de archivo image/png ejemplo
                        var fileType = file.type;

                        if (fileExtension == 'PNG' || fileExtension == 'png' ||fileExtension == 'JPG'|| fileExtension == 'jpg' && fileType =='imagen' || fileType =='image' || fileType =='image/jpeg' )
                        {
                            flag = true;
                        }else{
                            flag = false;
                        }
                        
                        if(idSesion!=''){
                            if (flag==false){
                                alert("Archivo invalido, seleccione una imagen ");
                                $("#file-input").val("");
                                $("#prev").hide();
                                $("#saveImagen").hide();


                            }else{  

                                 var pesoKb=(fileSize/1024);
                                 if (pesoKb<=6144){
                                    var frm = new FormData($("#formImagen")[0]);
                                    console.log(frm);
                                        if (flag != false) {
                                            $.ajax({
                                                data:frm,
                                                url:Routing.generate('ingresar_foto_venta'),
                                                type: 'POST',
                                                dataType: 'json',

                                                cache: false,
                                                contentType: false,
                                                processData: false,

                                                success: function(data){
                                                    $('#file-input').val('');

                                                    swal('','Imágenes subidas!','success');
                                                    $('#listadoImagenes').html('');
                                                    var key = 1;
                                                    for(i=0;i<data.length;i++){
                                                        $('#listadoImagenes').append('<div class=\"col-md-2\"><a class=\"verImagen\" href=\"{{ asset('Photos/Tmp/')}}'+data[i]+'\"><img style=\"width:100%;\" src=\"{{ asset('Photos/Tmp/')}}' + data[i] + '\"></a></div>');
                                                        key++;
                                                    }
                                                },
                                                error: function(data){
                                                    swal('','Hubo un error al subir las fotos!','error');
                                                }
                                            });
                                        }
                                    }
                                    else{
                                        swal('','Imagen demasiado grande, intente con una más pequeña!','error');
                                    }
                            }
                        }
                        else{
                            swal('','Debe guardar una sesión de tratamiento!','error');
                        }
                    }    
                });
                
                // Al momento de hacer click en resgistra abono
                $(document).on("click", "#registro-abono", function(){
                    var idpac = idPac;
                    var sucursal = $('#dgplusbellebundle_abono_sucursal').val();
                    var empleado = $('#dgplusbellebundle_abono_empleado').val();
                    var monto = $('#dgplusbellebundle_abono_monto').val();
                    var descripcion = $('#dgplusbellebundle_abono_descripcion').val();
                    var draw = '';
                
                    // Si se ha chequeado en el tipo de venta Paquete
                    if(id_ventapaquete > 0) {
                        var data = {
                            id : idpac,
                            sucursal : sucursal,
                            empleado: empleado,
                            monto: monto,
                            descripcion: descripcion,
                            id_ventapaquete : id_ventapaquete
                        };
                        console.log(deuda_total);
                        if(monto <= deuda_total){
                            // Se procede a registrar la sesion del tratamiento mediante ajax
                            $.ajax({
                                data:  data,
                                url:   '{{path('admin_abonopaquete_nuevo')}}',
                                type:  'post',
                                success:  function (response) {
                                    swal('','Abono de paquete registrado!','success');
                                    deuda_total = (response.costo - ((response.descuento * response.costo)/100) - response.abonos).toFixed(2);

                                    $('#detalle-venta-deuda').html('$ ' + deuda_total);
                                    return false;
                                }
                            });
                        }  else {
                            swal('','No se puede realizar esta operación. El monto ingresado es mayor a la deuda de este paquete!','error');
                            return false;
                        }
                        return false;
                    // Si se ha chequeado en el tipo de venta Tratamiento    
                    } else {
                       var data = {
                            id : idpac,
                            sucursal : sucursal,
                            empleado: empleado,
                            monto: monto,
                            descripcion: descripcion,
                            id_personatratamiento : id_ventatratamiento
                        };
                        if(monto <= deuda_total){
                            // Se procede a registrar la sesion del tratamiento mediante ajax
                            $.ajax({
                                data:  data,
                                url:   '{{path('admin_abonotratamiento_nuevo')}}',
                                type:  'post',
                                success:  function (response) {
                                    swal('','Abono de tratamiento registrado!','success');
                                    deuda_total = (response.costo - ((response.descuento * response.costo)/100) - response.abonos).toFixed(2);

                                    $('#detalle-venta-deuda').html('$ ' + deuda_total);
                                    return false;
                                }
                            });
                        }  else {
                            swal('','No se puede realizar esta operación. El monto ingresado es mayor a la deuda de este tratamiento!','error');
                            return false;
                        }  
                        return false;
                    }
                    
                    
                    return false;
                });
                
                //Seleccionar un registro
                $('#datatables1>tbody>tr').on('click', function(event) {
                    $("#editFormContainer").html();
                    
                    //Limpia los otros tr que esten activos
                    $('#datatables1>tbody>tr').each(function(index, val) {
                        $(this).removeClass("active");
                    });
                    //Se activa el registro en el que se hizo click
                    $(this).addClass("active");
                    //Se habilitan los botones de editar y borrar
                    $("#edit-datatables1").removeClass("disabled");
                    $("#delete-datatables1").removeClass("disabled");

                    //Obtener el id del registro
                    var link=$(this).attr("id");
                    
                });
                
                
                $("#tratamientos-datatables1").click(function(){
                    $("#tabla1").show();
                    $("#tabla2").hide();
                    $("#tabla3").hide();
                    $("#tabla4").hide();
                    $(this).addClass('btn btn-primary');
                    $("#ventapaquetes-datatables2").removeClass('btn btn-primary');
                    $("#consultas-datatables3").removeClass('btn btn-primary');
                    $("#ventapaquetes-datatables2").addClass('btn btn-default');
                    $("#consultas-datatables3").addClass('btn btn-default');
                    
                    $('#filterDatatables1').show();            
                    $('#filterDatatables2').hide();
                    $('#filterDatatables3').hide();
                    
                    $('#datatables2_filter').children().children().val('');
                    $('#datatables3_filter').children().children().val('');
                    
                });
                
                $("#ventapaquetes-datatables2").click(function(){
                    $("#tabla1").hide();
                    $("#tabla2").show();
                    $("#tabla3").hide();
                    $("#tabla4").hide();
                    $(this).addClass('btn btn-primary');
                    $("#tratamientos-datatables1").removeClass('btn btn-primary');
                    $("#consultas-datatables3").removeClass('btn btn-primary');
                    $("#tratamientos-datatables1").addClass('btn btn-default');
                    $("#consultas-datatables3").addClass('btn btn-default');
                    
                    $('#filterDatatables1').hide();
                    $('#filterDatatables2').show();
                    $('#filterDatatables3').hide();
                    
                    $('#datatables1_filter').children().children().val('');
                    $('#datatables3_filter').children().children().val('');
                    
                });
                
                $("#consultas-datatables3").click(function(){
                    $("#tabla1").hide();
                    $("#tabla2").hide();
                    $("#tabla3").show();
                    $("#tabla4").hide();
                    $(this).addClass('btn btn-primary');
                    $("#tratamientos-datatables1").removeClass('btn btn-primary');
                    $("#ventapaquetes-datatables2").removeClass('btn btn-primary');
                    $("#tratamientos-datatables1").addClass('btn btn-default');
                    $("#ventapaquetes-datatables2").addClass('btn btn-default');
                    
                    $('#filterDatatables1').hide();
                    $('#filterDatatables2').hide();
                    $('#filterDatatables3').show();
                    
                    $('#datatables1_filter').children().children().val('');
                    $('#datatables2_filter').children().children().val('');
                    
                });

                $('#filterDatatables1').on('keyup', function(event) {
                    var filtro = $(this).val(); 
                    $('#datatables1_filter>label>input').val($(this).val());
                    $('#datatables1_filter>label>input').keyup();

                });
                
                $('#filterDatatables2').on('keyup', function(event) {
                    var filtro = $(this).val(); 

                    $('#datatables2_filter>label>input').val($(this).val());
                    $('#datatables2_filter>label>input').keyup();
                });
                
                $('#filterDatatables3').on('keyup', function(event) {
                    var filtro = $(this).val(); 
                    //alert(filtro);
                    $('#datatables3_filter>label>input').val($(this).val());
                    $('#datatables3_filter>label>input').keyup();
                });
                
                $('#datatables1').DataTable({ 
                    searching:true,
                        "order":[[0, "desc"],[1,"desc"]],
                        "columnDefs": [
                               { "orderable": false, "targets": 0 },
                               { "orderable": false, "targets": 2 },
                               { "orderable": false, "targets": 3 },
                               { "orderable": false, "targets": 4 }

                        ],
                        "language": {
                        "info": "Mostrando página _PAGE_ de _PAGES_",
                        "infoEmpty": "",
                        "infoFiltered": "filtrando de _MAX_ registros",
                        "emptyTable": "No se encontraron registros",
                        "paginate": { 
                            "next": "Siguiente",
                            "previous": "Anterior"
                        },
                        "processing": "Procesando petición...",
                        "search": "Buscar registros:",
                        "lengthMenu": "Mostrar _MENU_ registros"
                    }, 

                    });
                
                
                $('#datatables2').DataTable({ 
                    searching:true,
                    "order":[[0, "desc"],[1,"desc"]],
                    "columnDefs": [
                           { "orderable": false, "targets": 0 }
                    ],
                    "language": {
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "",
                    "infoFiltered": "filtrando de _MAX_ registros",
                    "emptyTable": "No se encontraron registros",
                    "paginate": { 
                        "next": "Siguiente",
                        "previous": "Anterior"
                    },
                    "processing": "Procesando petición...",
                    "search": "Buscar registros:",
                    "lengthMenu": "Mostrar _MENU_ registros"
                }, 
                    
                });
                
                $('#datatables3').DataTable({ 
                    searching:true,
                        "order":[[0, "asc"],[1,"asc"]],
                        "columnDefs": [
                               { "orderable": false, "targets": 0 },
                               { "orderable": false, "targets": 2 },
                               { "orderable": false, "targets": 3 },
                               { "orderable": false, "targets": 4 },
                               { "orderable": false, "targets": 5 }
                        ],
                        "language": {
                        "info": "Mostrando página _PAGE_ de _PAGES_",
                        "infoEmpty": "",
                        "infoFiltered": "filtrando de _MAX_ registros",
                        "emptyTable": "No se encontraron registros",
                        "paginate": { 
                            "next": "Siguiente",
                            "previous": "Anterior"
                        },
                        "processing": "Procesando petición...",
                        "search": "Buscar registros:",
                        "lengthMenu": "Mostrar _MENU_ registros"
                    }, 

                    });
        

        $('#filterDatatables2').hide();
        $('#tabla2').hide();
        
        $('#datatables1_filter, #datatables2_filter,#datatables3_filter').hide();
        
        //Oculta la tabla consulta
        $('#filterDatatables3').hide();
        $('#tabla3').hide();
        $('#filterDatatables1, #filterDatatables2, #filterDatatables3').val('');
        
    });//Fin document ready
        
    //Definición de funciones
    function limpiarCampos(){
        //Limpiar los campos de tipo text
        $("input[type=text]").each(function(index, val) {
            $(this).val("");
        });
        //Seleccionar el primer elemento de los dropdown
        $('select option').each( function(index, val) {
            if(index == 0){
                $(this).attr("selected","selected");
            }
            else{
                $(this).removeAttr("selected");
            }

        
	});             
    };
    </script>
    
    <script>
        // Se procede a registrar la sesion del tratamiento mediante ajax
        function nuevaSesionPaqueteTratamiento(data){
            var mensaje = '';
            
            $.ajax({
                data:  data,
                url:   '{{path('admin_sesiontratamiento_nuevo')}}',
                type:  'post',
                success:  function (response) {
                    swal('','Sesión de tratamiento registrada!','success');
                    $('.close').click();
                    var tabsImagenes = document.getElementById('tabs-imagenes');
                    tabsImagenes.style.display = 'block';

                    var vtratamientos = $("#dgplusbellebundle_sesiones_tratamiento");
                    $('#idSesion').val(id_ventapaquete);

                    $.each( response.ventaPaquete, function( key, value ) {
                        mensaje+= '<div class="row">';
                        mensaje+= '<div class="col-md-5" style="margin-bottom: 10px;">';
                        mensaje+= '<span>' + value.ntrata + '</span>';
                        mensaje+= '</div>';
                        mensaje+= '<div class="col-md-7" style="margin-bottom: 10px;">';
                        mensaje+= '<div class="row">';

                        if(value.numSesion == 0){
                            for (var i = 0; i < value.sesiones; i++) {
                                mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                mensaje += '</div>';
                            }    
                        } else {
                            console.log(value.numSesion);
                            for (var i = 0; i < value.numSesion; i++) {
                                mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_realizada.png')}}" title="Sesion realizada">';
                                mensaje += '</div>';
                            }
                            for (var i = 0; i < value.sesiones - value.numSesion; i++) {
                                mensaje += '<div class="col-md-1" style="margin-bottom: 10px;">';
                                mensaje += '<img class="" style="height: 25px;"  src="{{ asset('Photos/Estados/sesion_pendiente.png')}}" title="Sesion pendiente">';
                                mensaje += '</div>';
                            }
                        }

                        mensaje+= '</div>';
                        mensaje+= '</div>';
                        mensaje+= '</div>';
                    });

                    $('#detalle-venta-tratamientos').html(mensaje);

                    // Se vacía el select
                    vtratamientos.find('option').remove();
                    vtratamientos.append('<option value="" disabled selected>Seleccione un tratamiento ...</option>');

                    $(response.tratVenta).each(function(i, v){ 
                        vtratamientos.append('<option value="' + v.id + '">' + v.nombre + '</option>');
                    });
                    
                    table1.ajax.reload();
                    $("#registro-sesiones-tratamiento").prop('disabled', false);
                    
                    $('#dgplusbellebundle_sesiones_sucursal').val('').change();
                    $('#dgplusbellebundle_sesiones_empleado').val('').change();
                    $('#dgplusbellebundle_sesiones_tratamiento').val('').change();
                }
            });
        }
    </script> 
    
    <script>  
        function nuevaSesionTratamiento(id){
            $.post( "{{path('admin_evaluar_sesiones_paquete')}}", { id: id }, function( data ) {
                var aux = 0;
                var total = data.query.length;
                
                // Calculando la deuda pendiente que tiene el paciente en el paquete seleccionado
                var deuda = ( (data.query[0].costoPaquete - ((data.query[0].porcentaje * data.query[0].costoPaquete)/100)) - data.abonos.abonos).toFixed(2);
                
                $.each( data.query, function( key, value ) {
                   if(value.numSesion >= value.sesiones){
                        aux = aux + 1;
                    }
                });   
                
                // Si exiten sesiones pendientes
                if(aux < total){
                    // Si el paciente no tiene deuda pendiente en el paquete seleccionado
                    if(deuda <= 0){
                        var url = Routing.generate('admin_sesiontratamiento_new', {'id': id});
                        window.open(url, "_self");
                        
                    // Si el paciente tiene deuda pendiente en el paquete seleccionado    
                    } else {
                        bootbox.confirm({ title: 'Confirmación de registro de nueva sesión',
                            message: 'El paciente tiene  una deuda de $' + deuda + ', en éste paquete ¿Desea continuar?',
                            buttons: {
                                'cancel': {
                                    label: 'Cancelar',
                                    className: 'btn-default pull-left'
                                },
                                'confirm': {
                                    label: 'Aceptar',
                                    className: 'btn-primary pull-right'
                                }
                            },
                            callback: function(result) {
                                // Si acepta continuar con el registro de una nueva sesion de tratamiento
                                if(result == true){ 
                                    var url = Routing.generate('admin_sesiontratamiento_new', {'id': id});
                                    window.open(url, "_self");
                                }
                            }
                        });      
                    }
                    
                // Si se han completado todas las sesiones de todos tratamientos que cuenta el paquete    
                } else {
                    swal('','Sesiones completadas, no se puede registrar una nueva para este paquete!','error');
                }
                
            }, "json"); // Fin de post    
                      
        }
    </script>
    <script>  
        function sesionTratamiento(id){
            $.post( "{{path('admin_evaluar_sesiones_tratamiento')}}", { id: id }, function( data ) {
                if(data.query[0].numSesion < data.query[0].sesiones){
                    var url = Routing.generate('admin_sesionventatratamiento_new', {'id': id});
                    window.open(url, "_self");
                } else {
                    swal('','Sesiones completadas, no se puede registrar una nueva!','error');
                }
            }, "json"); // Fin de post        
        }
    </script>
    <script>  
        function seguimientoPaquete(id){
            $("#tabla1").hide();
            $("#tabla2").hide();
            $("#tabla3").hide();
           $.post( "{{path('admin_busqueda_paquete_seguimiento')}}", { id: id }, function( data ) {
                var fecha = data.query[0].venta.split('-');
                var par = new Array();
               par = data.query;
                
                // Si el paquete vendido tiene sesiones de tratamiento
                if(par.length !== 0){
                    var mensaje = "";
                    mensaje += "<div class='panel-body'>";
                    mensaje += "<div class='clearfix'></div>"
                    mensaje += "<div class='col-md-1 col-md-offset-1 text-right' style='margin-top: 25px;'><b>Fecha de venta: </b></div><div class='col-md-2' style='margin-top: 25px;'>" + fecha[2] + "/" +fecha[1] + "/" +fecha[0] + "</div>";
                    mensaje += "<div class='col-md-1 text-right' style='margin-top: 25px;'><b>Paquete: </b></div><div class='col-md-3' style='margin-top: 25px;'>" + data.query[0].nomPaquete + "</div>";
                    mensaje += "<div class='col-md-1 text-right' style='margin-top: 25px;'><b>Vendido por: </b></div><div class='col-md-3' style='margin-top: 25px;'>" + data.query[0].empleado + "</div>";
                    mensaje += "<div class='clearfix'></div>"
                    
                    mensaje += "<div class='col-md-2 text-right' style='margin-top: 15px;'><b>Costo del paquete: </b></div><div class='col-md-1' style='margin-top: 15px;'> $ " + ( data.query[0].costoPaquete - 0 ).toFixed(2) + "</div>";
                    mensaje += "<div class='col-md-2 text-right' style='margin-top: 15px;'><b>Descuento aplicado: </b></div><div class='col-md-2' style='margin-top: 15px;'> $ " + ((data.query[0].porcentaje * data.query[0].costoPaquete)/100).toFixed(2) + "</div>";
                    mensaje += "<div class='col-md-2 text-right' style='margin-top: 15px;'><b>Monto total a cancelar: </b></div><div class='col-md-2' style='margin-top: 15px;'> $ " + ( data.query[0].costoPaquete - ((data.query[0].porcentaje * data.query[0].costoPaquete)/100)).toFixed(2) + "{#</b>#}</div>";
                    mensaje += "<div class='clearfix'></div>"
                    mensaje += "<div class='col-md-6 text-right' style='margin-top: 30px; margin-bottom: 30px;'><b style='font-size: 20px;'>Deuda pendiente: </b></div><div class='col-md-6' style='margin-top: 30px;'><b style='font-size: 20px;'> $ " + ( (data.query[0].costoPaquete - ((data.query[0].porcentaje * data.query[0].costoPaquete)/100)) - data.abonos.abonos).toFixed(2) + "</b></div>";
                    mensaje += "<div class='clearfix'></div>"
                    mensaje += "</div>";
                    
                    mensaje += "<div class='panel-body' style='margin-left: 14px; margin-right: 14px;'>";
                    mensaje += "<table class='table table-bordered table-condensed' style='margin-top:25px'>";
                    mensaje += "<thead>";
                    mensaje += "<tr><th class='text-center'>Tratamiento</th><th class='text-center'>Número de sesiones</th><th class='text-center'>Progreso del paquete</th></tr>";
                    mensaje += "</thead>";
                    mensaje += "<tbody>";
                    
                    $.each( data.query, function( key, value ) {
                        mensaje +=  "<tr><td>" + value.ntrata + "</td>";
                        mensaje +=  "<td class='text-center'>" + value.sesiones + "</td><td><div class'row'>";
                        if(value.numSesion == 0){
                            for (var i = 0; i < value.sesiones; i++) {
                                 mensaje +=  "<img class='' style='height: 50px;'  src='{{ asset('Photos/Estados/pendiente.png')}}' title='Sesion pendiente'>";
                            }    
                        } else {
                            for (var i = 0; i < value.numSesion; i++) {
                                mensaje +=  "<img class='' style='height: 50px;'  src='{{ asset('Photos/Estados/realizado.png')}}' title='Sesion realizada'>";
                            }
                            for (var i = 0; i < value.sesiones - value.numSesion; i++) {
                                mensaje +=  "<img class='' style='height: 50px;'  src='{{ asset('Photos/Estados/pendiente.png')}}' title='Sesion pendiente'>";
                            }
                            
                        }

                        mensaje+= "</div></td>";
                        mensaje+="</td></tr>";
                    });    

                    mensaje += "</tbody>";
                    mensaje += "</table>";
                    mensaje += "</div>";
                    

                    document.getElementById('tabla4').innerHTML = mensaje;   
                    $("#tabla4").show();
                }
                else{
                    console.log( 'Este paquete no tiene sesiones que mostrar' );
                }
            }, "json");
        }//Fin funcion
    </script>
    <script>  
        function seguimientoTratamiento(id){
            $("#tabla1").hide();
            $("#tabla2").hide();
            $("#tabla3").hide();
            $.post( "{{path('admin_busqueda_tratamiento_seguimiento')}}", { id: id }, function( data ) {
                console.log(data.query);
                
                var fecha = data.query[0].venta.split('-');
                var par = new Array();
                par = data.query;
                
                // Si el paquete vendido tiene sesiones de tratamiento
                if(par.length !== 0){
                    var mensaje = "";
                    
                    mensaje += "<div class='panel-body'>";
                    mensaje += "<div class='clearfix'></div>"
                    mensaje += "<div class='col-md-1 col-md-offset-1 text-right' style='margin-top: 25px;'><b>Fecha de venta: </b></div><div class='col-md-2' style='margin-top: 25px;'>" + fecha[2] + "/" +fecha[1] + "/" +fecha[0] + "</div>";
                    mensaje += "<div class='col-md-1 text-right' style='margin-top: 25px;'><b>Tratamiento: </b></div><div class='col-md-3' style='margin-top: 25px;'>" + data.query[0].ntratamiento + "</div>";
                    mensaje += "<div class='col-md-1 text-right' style='margin-top: 25px;'><b>Vendido por: </b></div><div class='col-md-3' style='margin-top: 25px;'>" + data.query[0].empleado + "</div>";
                    mensaje += "<div class='clearfix'></div>"
                    
                    mensaje += "<div class='col-md-2 text-right' style='margin-top: 15px;'><b>Costo del tratamiento: </b></div><div class='col-md-1' style='margin-top: 15px;'> $ " + ( data.query[0].costoTratamiento - 0 ).toFixed(2) + "</div>";
                    mensaje += "<div class='col-md-2 text-right' style='margin-top: 15px;'><b>Descuento aplicado: </b></div><div class='col-md-2' style='margin-top: 15px;'>{#<b style='color:red'>#} $ " + ((data.query[0].porcentaje * data.query[0].costoTratamiento)/100).toFixed(2) + "{#</b>#}</div>";
                    mensaje += "<div class='col-md-2 text-right' style='margin-top: 15px;'><b>Monto total a cancelar: </b></div><div class='col-md-2' style='margin-top: 15px;'>{#<b>#} $ " + ( data.query[0].costoTratamiento - ((data.query[0].porcentaje * data.query[0].costoTratamiento)/100)).toFixed(2) + "{#</b>#}</div>";
                    mensaje += "<div class='clearfix'></div>"
                    mensaje += "<div class='col-md-6 text-right' style='margin-top: 30px; margin-bottom: 30px;'><b style='font-size: 20px;'>Deuda pendiente: </b></div><div class='col-md-6' style='margin-top: 30px;'><b style='font-size: 20px;'> $ " + ( (data.query[0].costoTratamiento - ((data.query[0].porcentaje * data.query[0].costoTratamiento)/100)) - data.abonos.abonos).toFixed(2) + "</b></div>";
                    mensaje += "<div class='clearfix'></div>"
                    mensaje += "</div>";
                    
                    mensaje += "<div class='panel-body' style='margin-left: 14px; margin-right: 14px;'>";
                    mensaje += "<table class='table table-bordered table-condensed' style='margin-top:25px'>";
                    mensaje += "<thead>";
                    mensaje += "<tr><th class='text-center'>Nombre del tratamiento</th><th class='text-center'>Número de sesiones</th><th class='text-center'>Progreso del tratamiento</th></tr>";
                    mensaje += "</thead>";
                    mensaje += "<tbody>";
                    
                    $.each( data.query, function( key, value ) {
                        mensaje +=  "<tr><td>" + data.query[0].ntratamiento + "</td>";
                        mensaje +=  "<td class='text-center'>" + value.sesiones + "</td><td><div class'row'>";
                        if(value.numSesion == 0){
                            for (var i = 0; i < value.sesiones; i++) {
                                 mensaje +=  "<img class='' style='height: 50px;'  src='{{ asset('Photos/Estados/pendiente.png')}}' title='Sesion pendiente'>";
                            }    
                        } else {
                            for (var i = 0; i < value.numSesion; i++) {
                                mensaje +=  "<img class='' style='height: 50px;'  src='{{ asset('Photos/Estados/realizado.png')}}' title='Sesion realizada'>";
                            }
                            for (var i = 0; i < value.sesiones - value.numSesion; i++) {
                                mensaje +=  "<img class='' style='height: 50px;'  src='{{ asset('Photos/Estados/pendiente.png')}}' title='Sesion pendiente'>";
                            }
                            
                        }

                        mensaje+= "</div></td>";
                        mensaje+="</td></tr>";
                    });    

                    mensaje += "</tbody>";
                    mensaje += "</table>";
                    mensaje += "</div>";
                    
                    document.getElementById('tabla4').innerHTML = mensaje;   
                    $("#tabla4").show();

                }
                else{
                    console.log( 'Este paquete no tiene sesiones que mostrar' );
                }
             }, "json"); // Fin de post    
        } //Fin funcion seguimientoTratamiento
        
        function redondeoV4(numero, decimales)
        {
            var resultado = Math.round(numero*Math.pow(10,decimales))/Math.pow(10,decimales);
            return resultado;
        }
    </script>
    {% endblock %}
